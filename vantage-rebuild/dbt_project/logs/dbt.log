[0m01:18:30.085692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073ded10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10744ef90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10744f590>]}


============================== 01:18:30.089009 | 0731347a-0856-461a-ab3a-be2f2c0a9b32 ==============================
[0m01:18:30.089009 [info ] [MainThread]: Running with dbt=1.8.0
[0m01:18:30.089381 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project', 'log_path': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m01:18:30.388706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107421f50>]}
[0m01:18:30.414404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105493150>]}
[0m01:18:30.416029 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m01:18:30.534055 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m01:18:30.534887 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:18:30.535166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107495a50>]}
[0m01:18:31.197990 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.vantage_rebuild.marts
- models.vantage_rebuild.intermediate
[0m01:18:31.204129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bb73d0>]}
[0m01:18:31.263050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108017e50>]}
[0m01:18:31.263385 [info ] [MainThread]: Found 5 models, 1 seed, 5 sources, 438 macros
[0m01:18:31.264589 [info ] [MainThread]: 
[0m01:18:31.264900 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m01:18:31.267868 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_vantage'
[0m01:18:31.314120 [debug] [ThreadPool]: Using duckdb connection "list_vantage"
[0m01:18:31.314407 [debug] [ThreadPool]: On list_vantage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"vantage"'
    
  
  
[0m01:18:31.314563 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:33.379706 [debug] [ThreadPool]: SQL status: OK in 2.065 seconds
[0m01:18:33.381072 [debug] [ThreadPool]: On list_vantage: Close
[0m01:18:33.381554 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_vantage, now create_vantage_main)
[0m01:18:33.381805 [debug] [ThreadPool]: Creating schema "database: "vantage"
schema: "main"
"
[0m01:18:33.387281 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:33.387900 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='vantage'
        and type='sqlite'
    
  
[0m01:18:33.388132 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:18:33.389272 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:18:33.390132 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:33.390290 [debug] [ThreadPool]: On create_vantage_main: BEGIN
[0m01:18:33.390540 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:33.390671 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:33.390798 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
    
        create schema if not exists "vantage"."main"
    
[0m01:18:33.391205 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:33.391584 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:18:33.391723 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:33.391851 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:18:33.392391 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:33.392585 [debug] [ThreadPool]: On create_vantage_main: Close
[0m01:18:33.394856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_vantage_main, now list_vantage_main)
[0m01:18:33.398168 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:18:33.398406 [debug] [ThreadPool]: On list_vantage_main: BEGIN
[0m01:18:33.398659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:18:33.399102 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:33.399238 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:18:33.399381 [debug] [ThreadPool]: On list_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage_main"} */
select
      'vantage' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'vantage'
  
[0m01:18:33.420551 [debug] [ThreadPool]: SQL status: OK in 0.021 seconds
[0m01:18:33.422068 [debug] [ThreadPool]: On list_vantage_main: ROLLBACK
[0m01:18:33.422826 [debug] [ThreadPool]: Failed to rollback 'list_vantage_main'
[0m01:18:33.422986 [debug] [ThreadPool]: On list_vantage_main: Close
[0m01:18:33.423670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c64350>]}
[0m01:18:33.423930 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:33.424090 [debug] [MainThread]: On master: BEGIN
[0m01:18:33.424214 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:18:33.424577 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:33.424717 [debug] [MainThread]: On master: COMMIT
[0m01:18:33.424841 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:33.424966 [debug] [MainThread]: On master: COMMIT
[0m01:18:33.425231 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:33.425385 [debug] [MainThread]: On master: Close
[0m01:18:33.425607 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:18:33.425819 [info ] [MainThread]: 
[0m01:18:33.427526 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_budget
[0m01:18:33.427849 [info ] [Thread-1 (]: 1 of 6 START sql view model main.stg_budget .................................... [RUN]
[0m01:18:33.428103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_vantage_main, now model.vantage_rebuild.stg_budget)
[0m01:18:33.428270 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_budget
[0m01:18:33.432258 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_budget"
[0m01:18:33.432912 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_budget
[0m01:18:33.448449 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_budget"
[0m01:18:33.449103 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:33.449277 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: BEGIN
[0m01:18:33.449423 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:33.449773 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.449923 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:33.450093 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

  
  create view "vantage"."main"."stg_budget__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_budget"
),

renamed as (
    select
        cast(month as date) as budget_month,
        shop_id,
        currency as currency_code,
        budget_revenue,
        -- Generate MD5 key for unique identification if needed in future, though (month, shop) is unique
        concat(shop_id, '-', cast(month as varchar)) as budget_id
    from source
)

select * from renamed
  );

[0m01:18:33.451330 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:33.455206 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:33.455476 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget__dbt_tmp" rename to "stg_budget"
[0m01:18:33.456489 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:33.461018 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:18:33.461205 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:33.461378 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:18:33.462540 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:33.465299 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:33.465493 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

      drop view if exists "vantage"."main"."stg_budget__dbt_backup" cascade
    
[0m01:18:33.465841 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.466985 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: Close
[0m01:18:33.467797 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108375290>]}
[0m01:18:33.468226 [info ] [Thread-1 (]: 1 of 6 OK created sql view model main.stg_budget ............................... [[32mOK[0m in 0.04s]
[0m01:18:33.468581 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_budget
[0m01:18:33.468806 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_line_items
[0m01:18:33.469111 [info ] [Thread-1 (]: 2 of 6 START sql view model main.stg_line_items ................................ [RUN]
[0m01:18:33.469399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_budget, now model.vantage_rebuild.stg_line_items)
[0m01:18:33.469638 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_line_items
[0m01:18:33.471153 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_line_items"
[0m01:18:33.471538 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_line_items
[0m01:18:33.473212 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_line_items"
[0m01:18:33.473697 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:33.473874 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: BEGIN
[0m01:18:33.474021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:33.474373 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.474533 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:33.474702 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:18:33.477698 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:18:33.477891 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m01:18:33.478117 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: ROLLBACK
[0m01:18:33.481977 [debug] [Thread-1 (]: Failed to rollback 'model.vantage_rebuild.stg_line_items'
[0m01:18:33.482179 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: Close
[0m01:18:33.483322 [debug] [Thread-1 (]: Runtime Error in model stg_line_items (models/staging/stg_line_items.sql)
  Binder Error: Referenced column "quantity" not found in FROM clause!
  Candidate bindings: "unit_cost", "qty", "sku_id", "line_id", "unit_price_paid"
  
  LINE 14:         quantity,
                   ^
[0m01:18:33.483546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083b8290>]}
[0m01:18:33.483825 [error] [Thread-1 (]: 2 of 6 ERROR creating sql view model main.stg_line_items ....................... [[31mERROR[0m in 0.01s]
[0m01:18:33.484090 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_line_items
[0m01:18:33.484282 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_marketing
[0m01:18:33.484873 [info ] [Thread-1 (]: 3 of 6 START sql view model main.stg_marketing ................................. [RUN]
[0m01:18:33.485139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_line_items, now model.vantage_rebuild.stg_marketing)
[0m01:18:33.485327 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_marketing
[0m01:18:33.487115 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_marketing"
[0m01:18:33.487541 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_marketing
[0m01:18:33.489167 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_marketing"
[0m01:18:33.489455 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:33.489610 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: BEGIN
[0m01:18:33.489756 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:33.490154 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.490442 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:33.490623 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

  
  create view "vantage"."main"."stg_marketing__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_marketing_daily"
),

renamed as (
    select
        cast(date as date) as date_day,
        shop_id,
        spend_amount as marketing_spend_local,
        currency as currency_code
    from source
)

select * from renamed
  );

[0m01:18:33.491110 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.492582 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:33.492751 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing__dbt_tmp" rename to "stg_marketing"
[0m01:18:33.493046 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.493643 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:18:33.493798 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:33.493942 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:18:33.494308 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.495360 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:33.495525 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

      drop view if exists "vantage"."main"."stg_marketing__dbt_backup" cascade
    
[0m01:18:33.495788 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.496376 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: Close
[0m01:18:33.496687 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bee190>]}
[0m01:18:33.496965 [info ] [Thread-1 (]: 3 of 6 OK created sql view model main.stg_marketing ............................ [[32mOK[0m in 0.01s]
[0m01:18:33.497221 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_marketing
[0m01:18:33.497406 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_orders
[0m01:18:33.497629 [info ] [Thread-1 (]: 4 of 6 START sql view model main.stg_orders .................................... [RUN]
[0m01:18:33.497818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_marketing, now model.vantage_rebuild.stg_orders)
[0m01:18:33.497970 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_orders
[0m01:18:33.499338 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_orders"
[0m01:18:33.499705 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_orders
[0m01:18:33.502793 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_orders"
[0m01:18:33.503421 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:33.503600 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: BEGIN
[0m01:18:33.503752 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:33.504170 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.504325 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:33.504488 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

  
  create view "vantage"."main"."stg_orders__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_orders"
),

renamed as (
    select
        order_id,
        customer_id,
        shop_id,
        -- Correct datatypes
        cast(order_date as date) as order_date,
        currency_code
    from source
)

select * from renamed
  );

[0m01:18:33.504972 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.506553 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:33.506741 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m01:18:33.507299 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.507963 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:18:33.508132 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:33.508300 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:18:33.508746 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.509963 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:33.510128 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

      drop view if exists "vantage"."main"."stg_orders__dbt_backup" cascade
    
[0m01:18:33.510421 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.511013 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: Close
[0m01:18:33.511264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bee190>]}
[0m01:18:33.511548 [info ] [Thread-1 (]: 4 of 6 OK created sql view model main.stg_orders ............................... [[32mOK[0m in 0.01s]
[0m01:18:33.511817 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_orders
[0m01:18:33.512029 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_products
[0m01:18:33.512258 [info ] [Thread-1 (]: 5 of 6 START sql view model main.stg_products .................................. [RUN]
[0m01:18:33.512451 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_orders, now model.vantage_rebuild.stg_products)
[0m01:18:33.512605 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_products
[0m01:18:33.513985 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_products"
[0m01:18:33.514392 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_products
[0m01:18:33.515934 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_products"
[0m01:18:33.516246 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:33.516398 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: BEGIN
[0m01:18:33.516536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:33.516861 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.517004 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:33.517154 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

  
  create view "vantage"."main"."stg_products__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_products"
),

renamed as (
    select
        sku_id,
        category,
        product_name,
        avg_price_eur as list_price_eur,
        unit_cost_eur,
        popularity_score
    from source
)

select * from renamed
  );

[0m01:18:33.517609 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.520213 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:33.520541 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products__dbt_tmp" rename to "stg_products"
[0m01:18:33.520961 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.521610 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:18:33.521758 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:33.521896 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:18:33.522317 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.523520 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:33.523692 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

      drop view if exists "vantage"."main"."stg_products__dbt_backup" cascade
    
[0m01:18:33.523963 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.524529 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: Close
[0m01:18:33.524768 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a22c890>]}
[0m01:18:33.525036 [info ] [Thread-1 (]: 5 of 6 OK created sql view model main.stg_products ............................. [[32mOK[0m in 0.01s]
[0m01:18:33.525440 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_products
[0m01:18:33.525662 [debug] [Thread-1 (]: Began running node seed.vantage_rebuild.exchange_rates
[0m01:18:33.525908 [info ] [Thread-1 (]: 6 of 6 START seed file main.exchange_rates ..................................... [RUN]
[0m01:18:33.526167 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_products, now seed.vantage_rebuild.exchange_rates)
[0m01:18:33.526333 [debug] [Thread-1 (]: Began compiling node seed.vantage_rebuild.exchange_rates
[0m01:18:33.526507 [debug] [Thread-1 (]: Began executing node seed.vantage_rebuild.exchange_rates
[0m01:18:33.542022 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:33.542256 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: BEGIN
[0m01:18:33.542407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:33.542762 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.542905 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:33.543065 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "seed.vantage_rebuild.exchange_rates"} */

    create table "vantage"."main"."exchange_rates" ("date_day" date,"from_currency" text,"to_currency" text,"rate" float8)
  
[0m01:18:33.543371 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.548468 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:33.548664 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: 
          COPY "vantage"."main"."exchange_rates" FROM '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/seeds/exchange_rates.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m01:18:33.570465 [debug] [Thread-1 (]: SQL status: OK in 0.022 seconds
[0m01:18:33.573254 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.vantage_rebuild.exchange_rates"
[0m01:18:33.575699 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:18:33.575870 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:33.576014 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:18:33.576452 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:33.576777 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: Close
[0m01:18:33.577023 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0731347a-0856-461a-ab3a-be2f2c0a9b32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083bbf10>]}
[0m01:18:33.577256 [info ] [Thread-1 (]: 6 of 6 OK loaded seed file main.exchange_rates ................................. [[32mINSERT 366[0m in 0.05s]
[0m01:18:33.577507 [debug] [Thread-1 (]: Finished running node seed.vantage_rebuild.exchange_rates
[0m01:18:33.578035 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:33.578170 [debug] [MainThread]: On master: BEGIN
[0m01:18:33.578290 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:18:33.578525 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:33.578653 [debug] [MainThread]: On master: COMMIT
[0m01:18:33.578774 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:33.578893 [debug] [MainThread]: On master: COMMIT
[0m01:18:33.579091 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:33.579218 [debug] [MainThread]: On master: Close
[0m01:18:33.579375 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:18:33.579494 [debug] [MainThread]: Connection 'seed.vantage_rebuild.exchange_rates' was properly closed.
[0m01:18:33.579660 [info ] [MainThread]: 
[0m01:18:33.579809 [info ] [MainThread]: Finished running 5 view models, 1 seed in 0 hours 0 minutes and 2.31 seconds (2.31s).
[0m01:18:33.580354 [debug] [MainThread]: Command end result
[0m01:18:33.595345 [info ] [MainThread]: 
[0m01:18:33.595655 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:18:33.595916 [info ] [MainThread]: 
[0m01:18:33.596147 [error] [MainThread]:   Runtime Error in model stg_line_items (models/staging/stg_line_items.sql)
  Binder Error: Referenced column "quantity" not found in FROM clause!
  Candidate bindings: "unit_cost", "qty", "sku_id", "line_id", "unit_price_paid"
  
  LINE 14:         quantity,
                   ^
[0m01:18:33.596324 [info ] [MainThread]: 
[0m01:18:33.596495 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m01:18:33.628215 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 3.5822346, "process_user_time": 1.918043, "process_kernel_time": 0.375161, "process_mem_max_rss": "186515456", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:18:33.628630 [debug] [MainThread]: Command `dbt build` failed at 01:18:33.628581 after 3.58 seconds
[0m01:18:33.628844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10744f390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e2a390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107420c90>]}
[0m01:18:33.629122 [debug] [MainThread]: Flushing usage events
[0m01:18:44.953001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110de210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11112d0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113136d0>]}


============================== 01:18:44.956136 | 68b848b4-6fcd-4606-99b6-090b771b8dfa ==============================
[0m01:18:44.956136 [info ] [MainThread]: Running with dbt=1.8.0
[0m01:18:44.956462 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m01:18:45.146310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111312910>]}
[0m01:18:45.171087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107096ed0>]}
[0m01:18:45.172360 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m01:18:45.233855 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m01:18:45.301099 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:18:45.301633 [debug] [MainThread]: Partial parsing: updated file: vantage_rebuild://models/staging/stg_line_items.sql
[0m01:18:45.402129 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.vantage_rebuild.intermediate
- models.vantage_rebuild.marts
[0m01:18:45.408668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111aebb50>]}
[0m01:18:45.463014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ecfdd0>]}
[0m01:18:45.463332 [info ] [MainThread]: Found 5 models, 1 seed, 5 sources, 438 macros
[0m01:18:45.464547 [info ] [MainThread]: 
[0m01:18:45.464871 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m01:18:45.467286 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_vantage'
[0m01:18:45.492602 [debug] [ThreadPool]: Using duckdb connection "list_vantage"
[0m01:18:45.492868 [debug] [ThreadPool]: On list_vantage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"vantage"'
    
  
  
[0m01:18:45.493034 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:45.546994 [debug] [ThreadPool]: SQL status: OK in 0.054 seconds
[0m01:18:45.548442 [debug] [ThreadPool]: On list_vantage: Close
[0m01:18:45.548850 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_vantage, now create_vantage_main)
[0m01:18:45.549088 [debug] [ThreadPool]: Creating schema "database: "vantage"
schema: "main"
"
[0m01:18:45.553678 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:45.553964 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='vantage'
        and type='sqlite'
    
  
[0m01:18:45.554115 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:18:45.555095 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:18:45.555934 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:45.556088 [debug] [ThreadPool]: On create_vantage_main: BEGIN
[0m01:18:45.556324 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:45.556453 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:45.556578 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
    
        create schema if not exists "vantage"."main"
    
[0m01:18:45.556823 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:45.557181 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:18:45.557311 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:18:45.557432 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:18:45.557639 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:45.557769 [debug] [ThreadPool]: On create_vantage_main: Close
[0m01:18:45.558464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_vantage_main, now list_vantage_main)
[0m01:18:45.561765 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:18:45.562017 [debug] [ThreadPool]: On list_vantage_main: BEGIN
[0m01:18:45.562160 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:18:45.562624 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:18:45.562767 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:18:45.562907 [debug] [ThreadPool]: On list_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage_main"} */
select
      'vantage' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'vantage'
  
[0m01:18:45.574832 [debug] [ThreadPool]: SQL status: OK in 0.012 seconds
[0m01:18:45.575761 [debug] [ThreadPool]: On list_vantage_main: ROLLBACK
[0m01:18:45.576462 [debug] [ThreadPool]: Failed to rollback 'list_vantage_main'
[0m01:18:45.576619 [debug] [ThreadPool]: On list_vantage_main: Close
[0m01:18:45.616396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073ade90>]}
[0m01:18:45.616710 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:45.616859 [debug] [MainThread]: On master: BEGIN
[0m01:18:45.616988 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:18:45.617352 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:45.617484 [debug] [MainThread]: On master: COMMIT
[0m01:18:45.617614 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:45.617850 [debug] [MainThread]: On master: COMMIT
[0m01:18:45.618081 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:45.618343 [debug] [MainThread]: On master: Close
[0m01:18:45.618595 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:18:45.618777 [info ] [MainThread]: 
[0m01:18:45.620383 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_budget
[0m01:18:45.620701 [info ] [Thread-1 (]: 1 of 6 START sql view model main.stg_budget .................................... [RUN]
[0m01:18:45.621067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_vantage_main, now model.vantage_rebuild.stg_budget)
[0m01:18:45.621268 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_budget
[0m01:18:45.625192 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_budget"
[0m01:18:45.625585 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_budget
[0m01:18:45.640085 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_budget"
[0m01:18:45.640551 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:45.640718 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: BEGIN
[0m01:18:45.640866 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:45.641225 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.641368 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:45.641526 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

  
  create view "vantage"."main"."stg_budget__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_budget"
),

renamed as (
    select
        cast(month as date) as budget_month,
        shop_id,
        currency as currency_code,
        budget_revenue,
        -- Generate MD5 key for unique identification if needed in future, though (month, shop) is unique
        concat(shop_id, '-', cast(month as varchar)) as budget_id
    from source
)

select * from renamed
  );

[0m01:18:45.642029 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.645081 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:45.645275 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget" rename to "stg_budget__dbt_backup"
[0m01:18:45.646201 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:45.647859 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:45.648093 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget__dbt_tmp" rename to "stg_budget"
[0m01:18:45.648529 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.657434 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:18:45.657754 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:45.657918 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:18:45.660243 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m01:18:45.664493 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:18:45.664961 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

      drop view if exists "vantage"."main"."stg_budget__dbt_backup" cascade
    
[0m01:18:45.665710 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.667006 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: Close
[0m01:18:45.667920 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118af110>]}
[0m01:18:45.668294 [info ] [Thread-1 (]: 1 of 6 OK created sql view model main.stg_budget ............................... [[32mOK[0m in 0.05s]
[0m01:18:45.668575 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_budget
[0m01:18:45.668786 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_line_items
[0m01:18:45.669061 [info ] [Thread-1 (]: 2 of 6 START sql view model main.stg_line_items ................................ [RUN]
[0m01:18:45.669282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_budget, now model.vantage_rebuild.stg_line_items)
[0m01:18:45.669447 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_line_items
[0m01:18:45.671461 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_line_items"
[0m01:18:45.672050 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_line_items
[0m01:18:45.674286 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_line_items"
[0m01:18:45.675421 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:45.675660 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: BEGIN
[0m01:18:45.675903 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:45.676431 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:45.676644 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:45.676831 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        qty as quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:18:45.677466 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.681780 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:45.682174 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items__dbt_tmp" rename to "stg_line_items"
[0m01:18:45.682699 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.683489 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:18:45.683709 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:45.683923 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:18:45.685124 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:45.686591 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:18:45.686810 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

      drop view if exists "vantage"."main"."stg_line_items__dbt_backup" cascade
    
[0m01:18:45.687284 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.688094 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: Close
[0m01:18:45.688421 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110dd190>]}
[0m01:18:45.688796 [info ] [Thread-1 (]: 2 of 6 OK created sql view model main.stg_line_items ........................... [[32mOK[0m in 0.02s]
[0m01:18:45.689096 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_line_items
[0m01:18:45.689294 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_marketing
[0m01:18:45.689538 [info ] [Thread-1 (]: 3 of 6 START sql view model main.stg_marketing ................................. [RUN]
[0m01:18:45.689752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_line_items, now model.vantage_rebuild.stg_marketing)
[0m01:18:45.689915 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_marketing
[0m01:18:45.691394 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_marketing"
[0m01:18:45.691777 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_marketing
[0m01:18:45.694034 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_marketing"
[0m01:18:45.694488 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:45.694657 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: BEGIN
[0m01:18:45.695047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:45.695636 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:45.695835 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:45.696047 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

  
  create view "vantage"."main"."stg_marketing__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_marketing_daily"
),

renamed as (
    select
        cast(date as date) as date_day,
        shop_id,
        spend_amount as marketing_spend_local,
        currency as currency_code
    from source
)

select * from renamed
  );

[0m01:18:45.696836 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:45.698974 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:45.699197 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing" rename to "stg_marketing__dbt_backup"
[0m01:18:45.699675 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.701884 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:45.702151 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing__dbt_tmp" rename to "stg_marketing"
[0m01:18:45.702602 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.703446 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:18:45.703637 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:45.703791 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:18:45.704254 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.705559 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:18:45.705731 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

      drop view if exists "vantage"."main"."stg_marketing__dbt_backup" cascade
    
[0m01:18:45.706137 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.706772 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: Close
[0m01:18:45.707022 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110da4950>]}
[0m01:18:45.707292 [info ] [Thread-1 (]: 3 of 6 OK created sql view model main.stg_marketing ............................ [[32mOK[0m in 0.02s]
[0m01:18:45.707548 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_marketing
[0m01:18:45.707733 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_orders
[0m01:18:45.707950 [info ] [Thread-1 (]: 4 of 6 START sql view model main.stg_orders .................................... [RUN]
[0m01:18:45.708139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_marketing, now model.vantage_rebuild.stg_orders)
[0m01:18:45.708298 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_orders
[0m01:18:45.709792 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_orders"
[0m01:18:45.710310 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_orders
[0m01:18:45.712481 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_orders"
[0m01:18:45.713071 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:45.713248 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: BEGIN
[0m01:18:45.713398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:45.713835 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.714006 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:45.714178 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

  
  create view "vantage"."main"."stg_orders__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_orders"
),

renamed as (
    select
        order_id,
        customer_id,
        shop_id,
        -- Correct datatypes
        cast(order_date as date) as order_date,
        currency_code
    from source
)

select * from renamed
  );

[0m01:18:45.714704 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.716368 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:45.716563 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders" rename to "stg_orders__dbt_backup"
[0m01:18:45.716987 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.719292 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:45.719561 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m01:18:45.720073 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.720969 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:18:45.721206 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:45.721371 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:18:45.721880 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.723215 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:18:45.723457 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

      drop view if exists "vantage"."main"."stg_orders__dbt_backup" cascade
    
[0m01:18:45.723908 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.724579 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: Close
[0m01:18:45.724839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104d2510>]}
[0m01:18:45.725130 [info ] [Thread-1 (]: 4 of 6 OK created sql view model main.stg_orders ............................... [[32mOK[0m in 0.02s]
[0m01:18:45.725397 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_orders
[0m01:18:45.725594 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_products
[0m01:18:45.725824 [info ] [Thread-1 (]: 5 of 6 START sql view model main.stg_products .................................. [RUN]
[0m01:18:45.726026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_orders, now model.vantage_rebuild.stg_products)
[0m01:18:45.726186 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_products
[0m01:18:45.729202 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_products"
[0m01:18:45.729883 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_products
[0m01:18:45.734646 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_products"
[0m01:18:45.735206 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:45.735387 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: BEGIN
[0m01:18:45.735542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:45.735929 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.736087 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:45.736251 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

  
  create view "vantage"."main"."stg_products__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_products"
),

renamed as (
    select
        sku_id,
        category,
        product_name,
        avg_price_eur as list_price_eur,
        unit_cost_eur,
        popularity_score
    from source
)

select * from renamed
  );

[0m01:18:45.736760 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.739209 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:45.740318 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products" rename to "stg_products__dbt_backup"
[0m01:18:45.741963 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:18:45.746761 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:45.747598 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products__dbt_tmp" rename to "stg_products"
[0m01:18:45.748208 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.749035 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:18:45.749300 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:45.749527 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:18:45.750104 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.753093 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:18:45.754013 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

      drop view if exists "vantage"."main"."stg_products__dbt_backup" cascade
    
[0m01:18:45.754701 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.755786 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: Close
[0m01:18:45.756088 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b4a390>]}
[0m01:18:45.756403 [info ] [Thread-1 (]: 5 of 6 OK created sql view model main.stg_products ............................. [[32mOK[0m in 0.03s]
[0m01:18:45.756677 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_products
[0m01:18:45.756893 [debug] [Thread-1 (]: Began running node seed.vantage_rebuild.exchange_rates
[0m01:18:45.757164 [info ] [Thread-1 (]: 6 of 6 START seed file main.exchange_rates ..................................... [RUN]
[0m01:18:45.757404 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_products, now seed.vantage_rebuild.exchange_rates)
[0m01:18:45.757578 [debug] [Thread-1 (]: Began compiling node seed.vantage_rebuild.exchange_rates
[0m01:18:45.757740 [debug] [Thread-1 (]: Began executing node seed.vantage_rebuild.exchange_rates
[0m01:18:45.774333 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:45.774608 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: BEGIN
[0m01:18:45.774759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:18:45.775119 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.775270 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:45.775412 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "seed.vantage_rebuild.exchange_rates"} */
truncate table "vantage"."main"."exchange_rates"
[0m01:18:45.777321 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m01:18:45.782636 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:45.782836 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: 
          COPY "vantage"."main"."exchange_rates" FROM '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/seeds/exchange_rates.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m01:18:45.804404 [debug] [Thread-1 (]: SQL status: OK in 0.021 seconds
[0m01:18:45.807243 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.vantage_rebuild.exchange_rates"
[0m01:18:45.808157 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:18:45.808339 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:18:45.808496 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:18:45.809130 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:18:45.809596 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: Close
[0m01:18:45.809844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68b848b4-6fcd-4606-99b6-090b771b8dfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b31d10>]}
[0m01:18:45.810090 [info ] [Thread-1 (]: 6 of 6 OK loaded seed file main.exchange_rates ................................. [[32mINSERT 366[0m in 0.05s]
[0m01:18:45.810359 [debug] [Thread-1 (]: Finished running node seed.vantage_rebuild.exchange_rates
[0m01:18:45.810928 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:45.811069 [debug] [MainThread]: On master: BEGIN
[0m01:18:45.811193 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:18:45.811487 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:45.811660 [debug] [MainThread]: On master: COMMIT
[0m01:18:45.811798 [debug] [MainThread]: Using duckdb connection "master"
[0m01:18:45.811923 [debug] [MainThread]: On master: COMMIT
[0m01:18:45.812147 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:18:45.812279 [debug] [MainThread]: On master: Close
[0m01:18:45.812456 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:18:45.812580 [debug] [MainThread]: Connection 'seed.vantage_rebuild.exchange_rates' was properly closed.
[0m01:18:45.812748 [info ] [MainThread]: 
[0m01:18:45.812896 [info ] [MainThread]: Finished running 5 view models, 1 seed in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m01:18:45.813584 [debug] [MainThread]: Command end result
[0m01:18:45.828623 [info ] [MainThread]: 
[0m01:18:45.828907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:18:45.829064 [info ] [MainThread]: 
[0m01:18:45.829220 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m01:18:45.830640 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.91060156, "process_user_time": 1.329987, "process_kernel_time": 0.259673, "process_mem_max_rss": "153583616", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:18:45.830945 [debug] [MainThread]: Command `dbt build` succeeded at 01:18:45.830903 after 0.91 seconds
[0m01:18:45.831136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d79450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11135d090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b56dd0>]}
[0m01:18:45.831313 [debug] [MainThread]: Flushing usage events
[0m01:19:17.149512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076dedd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108012c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108013210>]}


============================== 01:19:17.153011 | cdef30e1-28c2-4dff-ba9f-3b9f81fa1332 ==============================
[0m01:19:17.153011 [info ] [MainThread]: Running with dbt=1.8.0
[0m01:19:17.153453 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt build', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:19:17.405543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108232ed0>]}
[0m01:19:17.429629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055bbd10>]}
[0m01:19:17.431274 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m01:19:17.495696 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m01:19:17.565418 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 4 files added, 0 files changed.
[0m01:19:17.565780 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/intermediate/int_marketing_allocated.sql
[0m01:19:17.565950 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/intermediate/int_exchange_rates.sql
[0m01:19:17.566098 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/intermediate/int_orders_standardized.sql
[0m01:19:17.566240 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/intermediate/int_logistics_costs.sql
[0m01:19:17.675574 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.vantage_rebuild.marts
[0m01:19:17.682445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895da50>]}
[0m01:19:17.739957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cd95d0>]}
[0m01:19:17.740316 [info ] [MainThread]: Found 9 models, 1 seed, 5 sources, 438 macros
[0m01:19:17.741631 [info ] [MainThread]: 
[0m01:19:17.741931 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m01:19:17.744283 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_vantage'
[0m01:19:17.772033 [debug] [ThreadPool]: Using duckdb connection "list_vantage"
[0m01:19:17.772333 [debug] [ThreadPool]: On list_vantage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"vantage"'
    
  
  
[0m01:19:17.772488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:17.819275 [debug] [ThreadPool]: SQL status: OK in 0.047 seconds
[0m01:19:17.820346 [debug] [ThreadPool]: On list_vantage: Close
[0m01:19:17.820750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_vantage, now create_vantage_main)
[0m01:19:17.820972 [debug] [ThreadPool]: Creating schema "database: "vantage"
schema: "main"
"
[0m01:19:17.824577 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:17.824861 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='vantage'
        and type='sqlite'
    
  
[0m01:19:17.825015 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:17.826026 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:19:17.826898 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:17.827078 [debug] [ThreadPool]: On create_vantage_main: BEGIN
[0m01:19:17.827353 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:17.827482 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:17.827611 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
    
        create schema if not exists "vantage"."main"
    
[0m01:19:17.828073 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:17.828534 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:19:17.828685 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:17.828816 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:19:17.829085 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:17.829240 [debug] [ThreadPool]: On create_vantage_main: Close
[0m01:19:17.829975 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_vantage_main, now list_vantage_main)
[0m01:19:17.833540 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:19:17.833773 [debug] [ThreadPool]: On list_vantage_main: BEGIN
[0m01:19:17.833902 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:17.834304 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:17.834616 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:19:17.834774 [debug] [ThreadPool]: On list_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage_main"} */
select
      'vantage' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'vantage'
  
[0m01:19:17.850354 [debug] [ThreadPool]: SQL status: OK in 0.015 seconds
[0m01:19:17.851838 [debug] [ThreadPool]: On list_vantage_main: ROLLBACK
[0m01:19:17.852672 [debug] [ThreadPool]: Failed to rollback 'list_vantage_main'
[0m01:19:17.852872 [debug] [ThreadPool]: On list_vantage_main: Close
[0m01:19:17.888008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c97210>]}
[0m01:19:17.888327 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:17.888473 [debug] [MainThread]: On master: BEGIN
[0m01:19:17.888596 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:19:17.888936 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:17.889069 [debug] [MainThread]: On master: COMMIT
[0m01:19:17.889183 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:17.889295 [debug] [MainThread]: On master: COMMIT
[0m01:19:17.889492 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:17.889619 [debug] [MainThread]: On master: Close
[0m01:19:17.889816 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:19:17.889963 [info ] [MainThread]: 
[0m01:19:17.891156 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_budget
[0m01:19:17.891385 [info ] [Thread-1 (]: 1 of 6 START sql view model main.stg_budget .................................... [RUN]
[0m01:19:17.891589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_vantage_main, now model.vantage_rebuild.stg_budget)
[0m01:19:17.891739 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_budget
[0m01:19:17.895771 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_budget"
[0m01:19:17.896194 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_budget
[0m01:19:17.910959 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_budget"
[0m01:19:17.911455 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:17.911620 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: BEGIN
[0m01:19:17.911762 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:17.912129 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.912292 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:17.912545 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

  
  create view "vantage"."main"."stg_budget__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_budget"
),

renamed as (
    select
        cast(month as date) as budget_month,
        shop_id,
        currency as currency_code,
        budget_revenue,
        -- Generate MD5 key for unique identification if needed in future, though (month, shop) is unique
        concat(shop_id, '-', cast(month as varchar)) as budget_id
    from source
)

select * from renamed
  );

[0m01:19:17.913112 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.916237 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:17.916440 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget" rename to "stg_budget__dbt_backup"
[0m01:19:17.917665 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:17.919477 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:17.919690 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget__dbt_tmp" rename to "stg_budget"
[0m01:19:17.920127 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.925655 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:19:17.925846 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:17.925995 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:19:17.926578 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.929245 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:17.929431 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

      drop view if exists "vantage"."main"."stg_budget__dbt_backup" cascade
    
[0m01:19:17.930024 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.931143 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: Close
[0m01:19:17.931759 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105471550>]}
[0m01:19:17.932040 [info ] [Thread-1 (]: 1 of 6 OK created sql view model main.stg_budget ............................... [[32mOK[0m in 0.04s]
[0m01:19:17.932302 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_budget
[0m01:19:17.932497 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_line_items
[0m01:19:17.932724 [info ] [Thread-1 (]: 2 of 6 START sql view model main.stg_line_items ................................ [RUN]
[0m01:19:17.932916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_budget, now model.vantage_rebuild.stg_line_items)
[0m01:19:17.933074 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_line_items
[0m01:19:17.934870 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_line_items"
[0m01:19:17.935341 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_line_items
[0m01:19:17.937321 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_line_items"
[0m01:19:17.937743 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:17.937907 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: BEGIN
[0m01:19:17.938055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:17.938415 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.938576 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:17.938745 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        qty as quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:19:17.939423 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.941971 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:17.942164 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items" rename to "stg_line_items__dbt_backup"
[0m01:19:17.942518 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.943808 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:17.943974 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items__dbt_tmp" rename to "stg_line_items"
[0m01:19:17.944271 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.945054 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:19:17.945214 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:17.945360 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:19:17.945737 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.946848 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:17.947014 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

      drop view if exists "vantage"."main"."stg_line_items__dbt_backup" cascade
    
[0m01:19:17.947403 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.948022 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: Close
[0m01:19:17.948291 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d1ce50>]}
[0m01:19:17.948598 [info ] [Thread-1 (]: 2 of 6 OK created sql view model main.stg_line_items ........................... [[32mOK[0m in 0.02s]
[0m01:19:17.948858 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_line_items
[0m01:19:17.949049 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_marketing
[0m01:19:17.949319 [info ] [Thread-1 (]: 3 of 6 START sql view model main.stg_marketing ................................. [RUN]
[0m01:19:17.949555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_line_items, now model.vantage_rebuild.stg_marketing)
[0m01:19:17.949728 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_marketing
[0m01:19:17.951289 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_marketing"
[0m01:19:17.951834 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_marketing
[0m01:19:17.954143 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_marketing"
[0m01:19:17.954603 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:17.955003 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: BEGIN
[0m01:19:17.955187 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:17.955588 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.955759 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:17.955930 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

  
  create view "vantage"."main"."stg_marketing__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_marketing_daily"
),

renamed as (
    select
        cast(date as date) as date_day,
        shop_id,
        spend_amount as marketing_spend_local,
        currency as currency_code
    from source
)

select * from renamed
  );

[0m01:19:17.956408 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.958039 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:17.958231 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing" rename to "stg_marketing__dbt_backup"
[0m01:19:17.958567 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.959845 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:17.960064 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing__dbt_tmp" rename to "stg_marketing"
[0m01:19:17.960374 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.961105 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:19:17.961277 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:17.961430 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:19:17.961901 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.963051 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:17.963225 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

      drop view if exists "vantage"."main"."stg_marketing__dbt_backup" cascade
    
[0m01:19:17.963664 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.964270 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: Close
[0m01:19:17.964520 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108217190>]}
[0m01:19:17.964809 [info ] [Thread-1 (]: 3 of 6 OK created sql view model main.stg_marketing ............................ [[32mOK[0m in 0.01s]
[0m01:19:17.965066 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_marketing
[0m01:19:17.965254 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_orders
[0m01:19:17.965508 [info ] [Thread-1 (]: 4 of 6 START sql view model main.stg_orders .................................... [RUN]
[0m01:19:17.965718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_marketing, now model.vantage_rebuild.stg_orders)
[0m01:19:17.965879 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_orders
[0m01:19:17.967217 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_orders"
[0m01:19:17.967560 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_orders
[0m01:19:17.969642 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_orders"
[0m01:19:17.970306 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:17.970485 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: BEGIN
[0m01:19:17.970642 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:17.971009 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.971167 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:17.971328 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

  
  create view "vantage"."main"."stg_orders__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_orders"
),

renamed as (
    select
        order_id,
        customer_id,
        shop_id,
        -- Correct datatypes
        cast(order_date as date) as order_date,
        currency_code
    from source
)

select * from renamed
  );

[0m01:19:17.971786 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.973281 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:17.973450 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders" rename to "stg_orders__dbt_backup"
[0m01:19:17.973753 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.975034 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:17.975194 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m01:19:17.975486 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.976136 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:19:17.976291 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:17.976432 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:19:17.976790 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.978747 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:17.978914 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

      drop view if exists "vantage"."main"."stg_orders__dbt_backup" cascade
    
[0m01:19:17.979292 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.979869 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: Close
[0m01:19:17.980121 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105be7f50>]}
[0m01:19:17.980403 [info ] [Thread-1 (]: 4 of 6 OK created sql view model main.stg_orders ............................... [[32mOK[0m in 0.01s]
[0m01:19:17.980655 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_orders
[0m01:19:17.980838 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_products
[0m01:19:17.981119 [info ] [Thread-1 (]: 5 of 6 START sql view model main.stg_products .................................. [RUN]
[0m01:19:17.981339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_orders, now model.vantage_rebuild.stg_products)
[0m01:19:17.981511 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_products
[0m01:19:17.982821 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_products"
[0m01:19:17.983155 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_products
[0m01:19:17.985076 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_products"
[0m01:19:17.985465 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:17.985629 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: BEGIN
[0m01:19:17.985781 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:17.986386 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:17.986575 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:17.986739 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

  
  create view "vantage"."main"."stg_products__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_products"
),

renamed as (
    select
        sku_id,
        category,
        product_name,
        avg_price_eur as list_price_eur,
        unit_cost_eur,
        popularity_score
    from source
)

select * from renamed
  );

[0m01:19:17.987260 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.988814 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:17.988995 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products" rename to "stg_products__dbt_backup"
[0m01:19:17.989304 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.990583 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:17.990747 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products__dbt_tmp" rename to "stg_products"
[0m01:19:17.991029 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.991703 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:19:17.991873 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:17.992020 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:19:17.992412 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.993520 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:17.993685 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

      drop view if exists "vantage"."main"."stg_products__dbt_backup" cascade
    
[0m01:19:17.994022 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:17.994577 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: Close
[0m01:19:17.994816 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ff7c10>]}
[0m01:19:17.995088 [info ] [Thread-1 (]: 5 of 6 OK created sql view model main.stg_products ............................. [[32mOK[0m in 0.01s]
[0m01:19:17.995334 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_products
[0m01:19:17.995526 [debug] [Thread-1 (]: Began running node seed.vantage_rebuild.exchange_rates
[0m01:19:17.995778 [info ] [Thread-1 (]: 6 of 6 START seed file main.exchange_rates ..................................... [RUN]
[0m01:19:17.995987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_products, now seed.vantage_rebuild.exchange_rates)
[0m01:19:17.996147 [debug] [Thread-1 (]: Began compiling node seed.vantage_rebuild.exchange_rates
[0m01:19:17.996297 [debug] [Thread-1 (]: Began executing node seed.vantage_rebuild.exchange_rates
[0m01:19:18.012878 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:18.013146 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: BEGIN
[0m01:19:18.013306 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:18.013663 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:18.013822 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:18.013969 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "seed.vantage_rebuild.exchange_rates"} */
truncate table "vantage"."main"."exchange_rates"
[0m01:19:18.015592 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:18.021420 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:18.021677 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: 
          COPY "vantage"."main"."exchange_rates" FROM '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/seeds/exchange_rates.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m01:19:18.042469 [debug] [Thread-1 (]: SQL status: OK in 0.021 seconds
[0m01:19:18.045242 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.vantage_rebuild.exchange_rates"
[0m01:19:18.046135 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:19:18.046310 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:18.046458 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:19:18.047136 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:18.047582 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: Close
[0m01:19:18.047825 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdef30e1-28c2-4dff-ba9f-3b9f81fa1332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087b3c90>]}
[0m01:19:18.048072 [info ] [Thread-1 (]: 6 of 6 OK loaded seed file main.exchange_rates ................................. [[32mINSERT 366[0m in 0.05s]
[0m01:19:18.048330 [debug] [Thread-1 (]: Finished running node seed.vantage_rebuild.exchange_rates
[0m01:19:18.048528 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_logistics_costs
[0m01:19:18.048793 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.vantage_rebuild.exchange_rates, now model.vantage_rebuild.int_logistics_costs)
[0m01:19:18.048959 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_logistics_costs
[0m01:19:18.050598 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_logistics_costs"
[0m01:19:18.051294 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_logistics_costs
[0m01:19:18.051510 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_exchange_rates
[0m01:19:18.051753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_logistics_costs, now model.vantage_rebuild.int_exchange_rates)
[0m01:19:18.051947 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_exchange_rates
[0m01:19:18.053407 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_exchange_rates"
[0m01:19:18.054096 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_exchange_rates
[0m01:19:18.054451 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_orders_standardized
[0m01:19:18.054715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_exchange_rates, now model.vantage_rebuild.int_orders_standardized)
[0m01:19:18.054885 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_orders_standardized
[0m01:19:18.062932 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_orders_standardized"
[0m01:19:18.063629 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_orders_standardized
[0m01:19:18.063996 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_marketing_allocated
[0m01:19:18.064242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_orders_standardized, now model.vantage_rebuild.int_marketing_allocated)
[0m01:19:18.064446 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_marketing_allocated
[0m01:19:18.072577 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_marketing_allocated"
[0m01:19:18.073266 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_marketing_allocated
[0m01:19:18.073868 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:18.074024 [debug] [MainThread]: On master: BEGIN
[0m01:19:18.074156 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:19:18.074516 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:18.074651 [debug] [MainThread]: On master: COMMIT
[0m01:19:18.074771 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:18.074890 [debug] [MainThread]: On master: COMMIT
[0m01:19:18.075108 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:18.075239 [debug] [MainThread]: On master: Close
[0m01:19:18.075413 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:19:18.075551 [debug] [MainThread]: Connection 'model.vantage_rebuild.int_marketing_allocated' was properly closed.
[0m01:19:18.075739 [info ] [MainThread]: 
[0m01:19:18.075951 [info ] [MainThread]: Finished running 5 view models, 1 seed in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m01:19:18.076505 [debug] [MainThread]: Command end result
[0m01:19:18.096286 [info ] [MainThread]: 
[0m01:19:18.096671 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:19:18.096831 [info ] [MainThread]: 
[0m01:19:18.096990 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m01:19:18.098473 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.98467994, "process_user_time": 1.347806, "process_kernel_time": 0.269595, "process_mem_max_rss": "157876224", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:19:18.098740 [debug] [MainThread]: Command `dbt build` succeeded at 01:19:18.098701 after 0.98 seconds
[0m01:19:18.098918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a9e390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fe9090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102997fd0>]}
[0m01:19:18.099088 [debug] [MainThread]: Flushing usage events
[0m01:19:57.004922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4a25d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4a2610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c513dd0>]}


============================== 01:19:57.008251 | 98a459c1-0f6a-4fe1-abff-48a1f81c54f2 ==============================
[0m01:19:57.008251 [info ] [MainThread]: Running with dbt=1.8.0
[0m01:19:57.008598 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:19:57.263420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c512910>]}
[0m01:19:57.288782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a397010>]}
[0m01:19:57.290436 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m01:19:57.355826 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m01:19:57.431155 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 5 files added, 0 files changed.
[0m01:19:57.431559 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/marts/fct_budget_daily.sql
[0m01:19:57.431734 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/marts/dim_calendar.sql
[0m01:19:57.431887 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/marts/dim_products.sql
[0m01:19:57.432029 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://models/marts/fct_transactions.sql
[0m01:19:57.432169 [debug] [MainThread]: Partial parsing: added file: vantage_rebuild://tests/assert_marketing_fully_allocated.sql
[0m01:19:57.592193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d580550>]}
[0m01:19:57.659188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dbca190>]}
[0m01:19:57.659544 [info ] [MainThread]: Found 13 models, 1 seed, 1 test, 5 sources, 438 macros
[0m01:19:57.661178 [info ] [MainThread]: 
[0m01:19:57.661542 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m01:19:57.664257 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_vantage'
[0m01:19:57.724437 [debug] [ThreadPool]: Using duckdb connection "list_vantage"
[0m01:19:57.724695 [debug] [ThreadPool]: On list_vantage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"vantage"'
    
  
  
[0m01:19:57.724848 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:57.766724 [debug] [ThreadPool]: SQL status: OK in 0.042 seconds
[0m01:19:57.767669 [debug] [ThreadPool]: On list_vantage: Close
[0m01:19:57.768495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_vantage, now create_vantage_main)
[0m01:19:57.768776 [debug] [ThreadPool]: Creating schema "database: "vantage"
schema: "main"
"
[0m01:19:57.772914 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:57.773215 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='vantage'
        and type='sqlite'
    
  
[0m01:19:57.773369 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:57.774377 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:19:57.775269 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:57.775472 [debug] [ThreadPool]: On create_vantage_main: BEGIN
[0m01:19:57.775779 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:57.775923 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:57.776063 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
    
        create schema if not exists "vantage"."main"
    
[0m01:19:57.776540 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:57.776977 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:19:57.777136 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:19:57.777269 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:19:57.777519 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:57.777661 [debug] [ThreadPool]: On create_vantage_main: Close
[0m01:19:57.778606 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_vantage_main, now list_vantage_main)
[0m01:19:57.781741 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:19:57.781990 [debug] [ThreadPool]: On list_vantage_main: BEGIN
[0m01:19:57.782130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:57.782553 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:19:57.782725 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:19:57.782876 [debug] [ThreadPool]: On list_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage_main"} */
select
      'vantage' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'vantage'
  
[0m01:19:57.794917 [debug] [ThreadPool]: SQL status: OK in 0.012 seconds
[0m01:19:57.796820 [debug] [ThreadPool]: On list_vantage_main: ROLLBACK
[0m01:19:57.797856 [debug] [ThreadPool]: Failed to rollback 'list_vantage_main'
[0m01:19:57.798092 [debug] [ThreadPool]: On list_vantage_main: Close
[0m01:19:57.799627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d64d690>]}
[0m01:19:57.799919 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:57.800090 [debug] [MainThread]: On master: BEGIN
[0m01:19:57.800267 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:19:57.800741 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:57.800936 [debug] [MainThread]: On master: COMMIT
[0m01:19:57.801295 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:57.801435 [debug] [MainThread]: On master: COMMIT
[0m01:19:57.801732 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:57.801913 [debug] [MainThread]: On master: Close
[0m01:19:57.802219 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:19:57.802551 [info ] [MainThread]: 
[0m01:19:57.804494 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.dim_calendar
[0m01:19:57.804785 [info ] [Thread-1 (]: 1 of 11 START sql table model main.dim_calendar ................................ [RUN]
[0m01:19:57.805032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_vantage_main, now model.vantage_rebuild.dim_calendar)
[0m01:19:57.805201 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.dim_calendar
[0m01:19:57.809066 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.dim_calendar"
[0m01:19:57.809620 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.dim_calendar
[0m01:19:57.848706 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.dim_calendar"
[0m01:19:57.865045 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:19:57.865698 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: BEGIN
[0m01:19:57.865900 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:57.866319 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.866492 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:19:57.866679 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

  
    
    

    create  table
      "vantage"."main"."dim_calendar__dbt_tmp"
  
    as (
      with recursive date_series as (
    select cast('2024-01-01' as date) as date_day
    union all
    select date_day + interval 1 day
    from date_series
    where date_day < '2024-12-31'
),

final as (
    select
        date_day as date_key,
        extract(year from date_day) as year,
        extract(month from date_day) as month_num,
        monthname(date_day) as month_name,
        week(date_day) as iso_week,
        dayofweek(date_day) as day_of_week_num, -- 0=Sun in some DBs, DuckDB: 0=Sun? No, DuckDB ISODOW is 1=Mon. dayofweek 0=Sun.
        case when dayofweek(date_day) in (0, 6) then true else false end as is_weekend
    from date_series
)

select * from final
    );
  
  
[0m01:19:57.904317 [debug] [Thread-1 (]: SQL status: OK in 0.037 seconds
[0m01:19:57.908555 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:19:57.908891 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */
alter table "vantage"."main"."dim_calendar__dbt_tmp" rename to "dim_calendar"
[0m01:19:57.909740 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:57.921827 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: COMMIT
[0m01:19:57.922153 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:19:57.922330 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: COMMIT
[0m01:19:57.924900 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m01:19:57.930351 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:19:57.931040 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

      drop table if exists "vantage"."main"."dim_calendar__dbt_backup" cascade
    
[0m01:19:57.931893 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.933196 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: Close
[0m01:19:57.933927 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d5694d0>]}
[0m01:19:57.934332 [info ] [Thread-1 (]: 1 of 11 OK created sql table model main.dim_calendar ........................... [[32mOK[0m in 0.13s]
[0m01:19:57.934849 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.dim_calendar
[0m01:19:57.935097 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_budget
[0m01:19:57.935372 [info ] [Thread-1 (]: 2 of 11 START sql view model main.stg_budget ................................... [RUN]
[0m01:19:57.935684 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.dim_calendar, now model.vantage_rebuild.stg_budget)
[0m01:19:57.935873 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_budget
[0m01:19:57.937519 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_budget"
[0m01:19:57.937969 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_budget
[0m01:19:57.949174 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_budget"
[0m01:19:57.949713 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:57.949896 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: BEGIN
[0m01:19:57.950177 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:57.950699 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:57.950947 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:57.951141 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

  
  create view "vantage"."main"."stg_budget__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_budget"
),

renamed as (
    select
        cast(month as date) as budget_month,
        shop_id,
        currency as currency_code,
        budget_revenue,
        -- Generate MD5 key for unique identification if needed in future, though (month, shop) is unique
        concat(shop_id, '-', cast(month as varchar)) as budget_id
    from source
)

select * from renamed
  );

[0m01:19:57.951887 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.954872 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:57.955242 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget" rename to "stg_budget__dbt_backup"
[0m01:19:57.955977 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:57.957864 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:57.958120 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget__dbt_tmp" rename to "stg_budget"
[0m01:19:57.958535 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.960485 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:19:57.960724 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:57.960884 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:19:57.961428 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.962675 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:19:57.962952 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

      drop view if exists "vantage"."main"."stg_budget__dbt_backup" cascade
    
[0m01:19:57.963452 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.964108 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: Close
[0m01:19:57.964377 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df16d10>]}
[0m01:19:57.964680 [info ] [Thread-1 (]: 2 of 11 OK created sql view model main.stg_budget .............................. [[32mOK[0m in 0.03s]
[0m01:19:57.964929 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_budget
[0m01:19:57.965127 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_line_items
[0m01:19:57.965438 [info ] [Thread-1 (]: 3 of 11 START sql view model main.stg_line_items ............................... [RUN]
[0m01:19:57.965704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_budget, now model.vantage_rebuild.stg_line_items)
[0m01:19:57.965897 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_line_items
[0m01:19:57.967242 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_line_items"
[0m01:19:57.967679 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_line_items
[0m01:19:57.970225 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_line_items"
[0m01:19:57.970700 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:57.970878 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: BEGIN
[0m01:19:57.971029 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:57.971410 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.971563 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:57.972029 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        qty as quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:19:57.972662 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.974282 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:57.974457 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items" rename to "stg_line_items__dbt_backup"
[0m01:19:57.974796 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.976144 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:57.976315 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items__dbt_tmp" rename to "stg_line_items"
[0m01:19:57.976615 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.977283 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:19:57.977431 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:57.977585 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:19:57.977980 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.979108 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:19:57.979274 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

      drop view if exists "vantage"."main"."stg_line_items__dbt_backup" cascade
    
[0m01:19:57.979640 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.980220 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: Close
[0m01:19:57.980480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de3ecd0>]}
[0m01:19:57.980746 [info ] [Thread-1 (]: 3 of 11 OK created sql view model main.stg_line_items .......................... [[32mOK[0m in 0.01s]
[0m01:19:57.980999 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_line_items
[0m01:19:57.981187 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_marketing
[0m01:19:57.981412 [info ] [Thread-1 (]: 4 of 11 START sql view model main.stg_marketing ................................ [RUN]
[0m01:19:57.981603 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_line_items, now model.vantage_rebuild.stg_marketing)
[0m01:19:57.981759 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_marketing
[0m01:19:57.983021 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_marketing"
[0m01:19:57.983330 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_marketing
[0m01:19:57.985264 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_marketing"
[0m01:19:57.985704 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:57.985871 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: BEGIN
[0m01:19:57.986016 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:57.986369 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.986530 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:57.986698 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

  
  create view "vantage"."main"."stg_marketing__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_marketing_daily"
),

renamed as (
    select
        cast(date as date) as date_day,
        shop_id,
        spend_amount as marketing_spend_local,
        currency as currency_code
    from source
)

select * from renamed
  );

[0m01:19:57.987155 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.988759 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:57.988944 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing" rename to "stg_marketing__dbt_backup"
[0m01:19:57.989257 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.991391 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:57.991558 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing__dbt_tmp" rename to "stg_marketing"
[0m01:19:57.991858 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.992513 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:19:57.992676 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:57.992823 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:19:57.993208 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.994314 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:19:57.994508 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

      drop view if exists "vantage"."main"."stg_marketing__dbt_backup" cascade
    
[0m01:19:57.994886 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:57.995462 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: Close
[0m01:19:57.995740 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df48410>]}
[0m01:19:57.996061 [info ] [Thread-1 (]: 4 of 11 OK created sql view model main.stg_marketing ........................... [[32mOK[0m in 0.01s]
[0m01:19:57.996341 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_marketing
[0m01:19:57.996532 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_orders
[0m01:19:57.996760 [info ] [Thread-1 (]: 5 of 11 START sql view model main.stg_orders ................................... [RUN]
[0m01:19:57.996954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_marketing, now model.vantage_rebuild.stg_orders)
[0m01:19:57.997108 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_orders
[0m01:19:57.998473 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_orders"
[0m01:19:57.998826 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_orders
[0m01:19:58.000435 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_orders"
[0m01:19:58.001084 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:58.001261 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: BEGIN
[0m01:19:58.001410 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.001765 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.002236 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:58.002420 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

  
  create view "vantage"."main"."stg_orders__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_orders"
),

renamed as (
    select
        order_id,
        customer_id,
        shop_id,
        -- Correct datatypes
        cast(order_date as date) as order_date,
        currency_code
    from source
)

select * from renamed
  );

[0m01:19:58.002941 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.004565 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:58.004732 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders" rename to "stg_orders__dbt_backup"
[0m01:19:58.005049 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.006336 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:58.006484 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m01:19:58.006740 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.007378 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:19:58.007533 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:58.007676 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:19:58.008053 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.009206 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:19:58.009377 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

      drop view if exists "vantage"."main"."stg_orders__dbt_backup" cascade
    
[0m01:19:58.009751 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.010365 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: Close
[0m01:19:58.010636 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d61d610>]}
[0m01:19:58.010922 [info ] [Thread-1 (]: 5 of 11 OK created sql view model main.stg_orders .............................. [[32mOK[0m in 0.01s]
[0m01:19:58.011178 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_orders
[0m01:19:58.011366 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_products
[0m01:19:58.011640 [info ] [Thread-1 (]: 6 of 11 START sql view model main.stg_products ................................. [RUN]
[0m01:19:58.011844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_orders, now model.vantage_rebuild.stg_products)
[0m01:19:58.012001 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_products
[0m01:19:58.013325 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_products"
[0m01:19:58.013635 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_products
[0m01:19:58.015214 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_products"
[0m01:19:58.015495 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:58.015645 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: BEGIN
[0m01:19:58.015786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.016079 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.016224 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:58.016379 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

  
  create view "vantage"."main"."stg_products__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_products"
),

renamed as (
    select
        sku_id,
        category,
        product_name,
        avg_price_eur as list_price_eur,
        unit_cost_eur,
        popularity_score
    from source
)

select * from renamed
  );

[0m01:19:58.016834 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.018915 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:58.019171 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products" rename to "stg_products__dbt_backup"
[0m01:19:58.019671 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.021091 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:58.021248 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products__dbt_tmp" rename to "stg_products"
[0m01:19:58.021529 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.022188 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:19:58.022345 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:58.022484 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:19:58.022868 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.023997 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:19:58.024167 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

      drop view if exists "vantage"."main"."stg_products__dbt_backup" cascade
    
[0m01:19:58.024516 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.025088 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: Close
[0m01:19:58.025330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df7dd50>]}
[0m01:19:58.025595 [info ] [Thread-1 (]: 6 of 11 OK created sql view model main.stg_products ............................ [[32mOK[0m in 0.01s]
[0m01:19:58.025845 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_products
[0m01:19:58.026052 [debug] [Thread-1 (]: Began running node seed.vantage_rebuild.exchange_rates
[0m01:19:58.026318 [info ] [Thread-1 (]: 7 of 11 START seed file main.exchange_rates .................................... [RUN]
[0m01:19:58.026511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_products, now seed.vantage_rebuild.exchange_rates)
[0m01:19:58.026665 [debug] [Thread-1 (]: Began compiling node seed.vantage_rebuild.exchange_rates
[0m01:19:58.026805 [debug] [Thread-1 (]: Began executing node seed.vantage_rebuild.exchange_rates
[0m01:19:58.043377 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:58.043608 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: BEGIN
[0m01:19:58.043758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.044107 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.044254 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:58.044398 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "seed.vantage_rebuild.exchange_rates"} */
truncate table "vantage"."main"."exchange_rates"
[0m01:19:58.044990 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.050251 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:58.050439 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: 
          COPY "vantage"."main"."exchange_rates" FROM '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/seeds/exchange_rates.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m01:19:58.070360 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m01:19:58.073076 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.vantage_rebuild.exchange_rates"
[0m01:19:58.073953 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:19:58.074130 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:19:58.074287 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:19:58.074862 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.075184 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: Close
[0m01:19:58.075432 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df12950>]}
[0m01:19:58.075650 [info ] [Thread-1 (]: 7 of 11 OK loaded seed file main.exchange_rates ................................ [[32mINSERT 366[0m in 0.05s]
[0m01:19:58.075901 [debug] [Thread-1 (]: Finished running node seed.vantage_rebuild.exchange_rates
[0m01:19:58.076093 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.fct_budget_daily
[0m01:19:58.076401 [info ] [Thread-1 (]: 8 of 11 START sql table model main.fct_budget_daily ............................ [RUN]
[0m01:19:58.076635 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.vantage_rebuild.exchange_rates, now model.vantage_rebuild.fct_budget_daily)
[0m01:19:58.076807 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.fct_budget_daily
[0m01:19:58.078233 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.078554 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.fct_budget_daily
[0m01:19:58.080081 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.080375 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.080526 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: BEGIN
[0m01:19:58.080665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.080951 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.081106 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.081289 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

  
    
    

    create  table
      "vantage"."main"."fct_budget_daily__dbt_tmp"
  
    as (
      with budget as (
    select * from "vantage"."main"."stg_budget"
),

-- Generate Daily Budget (Linear Split)
-- We need a date spine, but for MVP we can fan out by joining to a calendar or just dividing by 30
-- Ideally use dbt_utils.date_spine.
-- Hack for MVP: Just keep it Monthly? No, spec says Daily.
-- We will assume 30 days per month for simplicity here to avoid massive join complexity without a calendar source.
-- BETTER: Use recursive CTE to generate days.

dates as (
    -- Recursively generate days for 2024
    with recursive date_series as (
        select cast('2024-01-01' as date) as date_day
        union all
        select date_day + interval 1 day
        from date_series
        where date_day < '2024-12-31'
    )
    select * from date_series
),

final as (
    select
        d.date_day,
        b.shop_id,
        b.currency_code,
        -- Simple allocation: Monthly Budget / Days in Month
        b.budget_revenue / extract(day from last_day(d.date_day)) as daily_budget_revenue
    from budget b
    inner join dates d 
        on extract(month from d.date_day) = extract(month from b.budget_month)
        and extract(year from d.date_day) = extract(year from b.budget_month)
)

select * from final
    );
  
  
[0m01:19:58.117167 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m01:19:58.119173 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.119467 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */
alter table "vantage"."main"."fct_budget_daily__dbt_tmp" rename to "fct_budget_daily"
[0m01:19:58.119941 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.120729 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: COMMIT
[0m01:19:58.120905 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.121049 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: COMMIT
[0m01:19:58.121547 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.122751 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:19:58.122912 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

      drop table if exists "vantage"."main"."fct_budget_daily__dbt_backup" cascade
    
[0m01:19:58.123178 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.123748 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: Close
[0m01:19:58.123993 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de70710>]}
[0m01:19:58.124267 [info ] [Thread-1 (]: 8 of 11 OK created sql table model main.fct_budget_daily ....................... [[32mOK[0m in 0.05s]
[0m01:19:58.124516 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.fct_budget_daily
[0m01:19:58.124694 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_logistics_costs
[0m01:19:58.124898 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.fct_budget_daily, now model.vantage_rebuild.int_logistics_costs)
[0m01:19:58.125051 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_logistics_costs
[0m01:19:58.126535 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_logistics_costs"
[0m01:19:58.126965 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_logistics_costs
[0m01:19:58.127138 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.dim_products
[0m01:19:58.127350 [info ] [Thread-1 (]: 9 of 11 START sql table model main.dim_products ................................ [RUN]
[0m01:19:58.127530 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_logistics_costs, now model.vantage_rebuild.dim_products)
[0m01:19:58.127682 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.dim_products
[0m01:19:58.128885 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.dim_products"
[0m01:19:58.129158 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.dim_products
[0m01:19:58.130775 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.dim_products"
[0m01:19:58.131089 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:19:58.131241 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: BEGIN
[0m01:19:58.131379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.131705 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.131849 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:19:58.132008 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

  
    
    

    create  table
      "vantage"."main"."dim_products__dbt_tmp"
  
    as (
      with products as (
    select * from "vantage"."main"."stg_products"
)

select
    sku_id,
    product_name,
    category,
    -- Simple tiers based on price/category
    case 
        when category = 'Ausrüstung' then 'Hardware'
        when category = 'Schuhe' then 'Footwear'
        else 'Apparel'
    end as business_unit,
    list_price_eur
from products
    );
  
  
[0m01:19:58.133390 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:19:58.136310 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:19:58.136555 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */
alter table "vantage"."main"."dim_products__dbt_tmp" rename to "dim_products"
[0m01:19:58.137033 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.137823 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: COMMIT
[0m01:19:58.138010 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:19:58.138166 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: COMMIT
[0m01:19:58.138649 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.139861 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:19:58.140031 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

      drop table if exists "vantage"."main"."dim_products__dbt_backup" cascade
    
[0m01:19:58.140312 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.140875 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: Close
[0m01:19:58.141111 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dfca990>]}
[0m01:19:58.141392 [info ] [Thread-1 (]: 9 of 11 OK created sql table model main.dim_products ........................... [[32mOK[0m in 0.01s]
[0m01:19:58.141639 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.dim_products
[0m01:19:58.141821 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_exchange_rates
[0m01:19:58.142041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.dim_products, now model.vantage_rebuild.int_exchange_rates)
[0m01:19:58.142210 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_exchange_rates
[0m01:19:58.143567 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_exchange_rates"
[0m01:19:58.143994 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_exchange_rates
[0m01:19:58.144313 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_orders_standardized
[0m01:19:58.144506 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_exchange_rates, now model.vantage_rebuild.int_orders_standardized)
[0m01:19:58.144658 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_orders_standardized
[0m01:19:58.151917 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_orders_standardized"
[0m01:19:58.152557 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_orders_standardized
[0m01:19:58.152905 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_marketing_allocated
[0m01:19:58.153125 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_orders_standardized, now model.vantage_rebuild.int_marketing_allocated)
[0m01:19:58.153292 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_marketing_allocated
[0m01:19:58.160648 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_marketing_allocated"
[0m01:19:58.161159 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_marketing_allocated
[0m01:19:58.161492 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.fct_transactions
[0m01:19:58.161730 [info ] [Thread-1 (]: 10 of 11 START sql table model main.fct_transactions ........................... [RUN]
[0m01:19:58.161933 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_marketing_allocated, now model.vantage_rebuild.fct_transactions)
[0m01:19:58.162091 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.fct_transactions
[0m01:19:58.170068 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.fct_transactions"
[0m01:19:58.170572 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.fct_transactions
[0m01:19:58.172709 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.fct_transactions"
[0m01:19:58.173063 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:19:58.173230 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: BEGIN
[0m01:19:58.173381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.173785 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:19:58.173984 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:19:58.174398 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */

  
    
    

    create  table
      "vantage"."main"."fct_transactions__dbt_tmp"
  
    as (
      with  __dbt__cte__int_exchange_rates as (
with rate_source as (
    select * from "vantage"."main"."exchange_rates"
),

final as (
    select
        date_day,
        from_currency,
        to_currency,
        rate
    from rate_source
    -- We assume only 'to_currency' = EUR matters for now
    where to_currency = 'EUR'
)

select * from final
),  __dbt__cte__int_orders_standardized as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

rates as (
    select * from __dbt__cte__int_exchange_rates
),

-- Join all together
joined as (
    select
        l.line_item_id,
        l.order_id,
        o.shop_id,
        o.customer_id,
        o.order_date,
        o.currency_code,
        l.sku_id,
        l.quantity,
        l.unit_price_local,
        l.unit_cost_local,
        l.is_returned,
        
        -- Exchange Rate Lookup
        -- If currency is EUR, rate is 1.0. If not, join to rates.
        coalesce(r.rate, 1.0) as exchange_rate

    from line_items l
    left join orders o on l.order_id = o.order_id
    left join rates r 
        on o.order_date = r.date_day 
        and o.currency_code = r.from_currency
        and r.to_currency = 'EUR'
),

calculated as (
    select
        *,
        -- Monetary conversions
        unit_price_local * exchange_rate as unit_price_eur,
        unit_cost_local * exchange_rate as unit_cost_eur,
        
        -- Line Totals
        (unit_price_local * exchange_rate) * quantity as gross_revenue_eur,
        (unit_cost_local * exchange_rate) * quantity as cogs_eur
        
    from joined
)

select * from calculated
),  __dbt__cte__int_marketing_allocated as (
with orders_std as (
    select * from __dbt__cte__int_orders_standardized
),

marketing_daily as (
    select * from "vantage"."main"."stg_marketing"
),

-- 1. Daily Sales Summary (Dominator for allocation)
daily_sales as (
    select
        order_date,
        shop_id,
        sum(gross_revenue_eur) as total_daily_revenue_eur
    from orders_std
    group by 1, 2
),

-- 2. Daily Spend (Numerator)
daily_spend as (
    select
        date_day,
        shop_id,
        -- Assume marketing spend in stg is already standardized or matches shop currency
        -- If shop_id=CH, marketing is likely in CHF. We should convert it to EUR too if generating strictly in EUR.
        -- Usage: For simplicity, let's assume raw_marketing_daily is in EUR or close enough for this MVP 
        -- (Since shop_id=CH has base currency CHF, but marketing might be global). 
        -- Actually, generator output has 'currency' col.
        marketing_spend_local
    from marketing_daily
),

-- 3. Allocation Factor
allocation_factors as (
    select
        ds.order_date,
        ds.shop_id,
        ds.total_daily_revenue_eur,
        msp.marketing_spend_local as daily_marketing_spend,
        -- Avoid divide by zero
        case 
            when ds.total_daily_revenue_eur > 0 
            then msp.marketing_spend_local / ds.total_daily_revenue_eur 
            else 0 
        end as cost_per_eur_revenue
    from daily_sales ds
    inner join daily_spend msp 
        on ds.order_date = msp.date_day 
        and ds.shop_id = msp.shop_id
),

-- 4. Apply to Lines
final_allocation as (
    select
        ord.line_item_id,
        ord.order_id,
        ord.gross_revenue_eur,
        af.cost_per_eur_revenue,
        
        -- Allocated Cost
        ord.gross_revenue_eur * af.cost_per_eur_revenue as marketing_cost_allocated_eur
        
    from orders_std ord
    left join allocation_factors af 
        on ord.order_date = af.order_date 
        and ord.shop_id = af.shop_id
)

select * from final_allocation
),  __dbt__cte__int_logistics_costs as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

-- Aggregate items per order
order_stats as (
    select
        order_id,
        count(*) as item_count
    from line_items
    group by 1
),

joined as (
    select
        o.order_id,
        o.shop_id,
        s.item_count
    from orders o
    left join order_stats s on o.order_id = s.order_id
),

-- Rule Engine for Logistics
calculated as (
    select
        order_id,
        shop_id,
        item_count,
        -- Rule: Base 3.50 EUR (8.50 CH) + 0.50 per item
        case
            when shop_id = 'CH' then 8.50 + (item_count * 0.50)
            else 3.50 + (item_count * 0.50)
        end as logistics_cost_eur
    from joined
)

select * from calculated
), orders_allocated as (
    select * from __dbt__cte__int_marketing_allocated
),

logistics as (
    select * from __dbt__cte__int_logistics_costs
),

final as (
    select
        -- Keys
        o.order_id,
        o.line_item_id,
        
        -- Dimensions
        cast(orders_allocated.order_date as date) as date_key,
        orders_allocated.shop_id as shop_key,
        orders_allocated.customer_id as customer_key,
        orders_allocated.sku_id as product_key,
        
        -- Metrics
        orders_allocated.quantity,
        orders_allocated.gross_revenue_eur,
        
        -- Costs
        -- COGS
        orders_allocated.gross_revenue_eur * (orders_allocated.unit_cost_local / orders_allocated.unit_price_local) as cogs_eur, 
        -- (Doing Ratio calc to be safe on currency, or just use unit_cost_eur column if I had it exposed... 
        -- Wait, int_orders_standardized calculates cogs_eur. 
        -- But int_marketing_allocated only selects a few cols! 
        -- I should update int_marketing_allocated to select * or join back.)
        
        -- Let's assume standard joins back to `int_orders_standardized` for cleanliness, 
        -- OR update `int_marketing_allocated` to pass through everything.
        -- Looking at `int_marketing_allocated.sql`, it selects specific cols. 
        -- I will join back to `int_orders_standardized` here.
        
        orders_std.cogs_eur,
        
        -- Logistics (Allocated by Item Count weighting)
        -- Logic: Total Order Logistics Cost / Total Items in Order
        (l.logistics_cost_eur / l.item_count) as logistics_allocated_eur,
        
        -- Marketing (Already allocated)
        orders_allocated.marketing_cost_allocated_eur,
        
        -- Margin
        orders_allocated.gross_revenue_eur 
            - orders_std.cogs_eur 
            - (l.logistics_cost_eur / l.item_count)
            - orders_allocated.marketing_cost_allocated_eur 
        as contribution_margin_eur,
        
        orders_std.is_returned

    from orders_allocated
    
    -- Join back to Standardized for COGS/Attributes
    left join __dbt__cte__int_orders_standardized orders_std 
        using (line_item_id)
        
    -- Join Logistics
    left join logistics l 
        using (order_id)
)

select * from final
    );
  
  
[0m01:19:58.185384 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */

  
    
    

    create  table
      "vantage"."main"."fct_transactions__dbt_tmp"
  
    as (
      with  __dbt__cte__int_exchange_rates as (
with rate_source as (
    select * from "vantage"."main"."exchange_rates"
),

final as (
    select
        date_day,
        from_currency,
        to_currency,
        rate
    from rate_source
    -- We assume only 'to_currency' = EUR matters for now
    where to_currency = 'EUR'
)

select * from final
),  __dbt__cte__int_orders_standardized as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

rates as (
    select * from __dbt__cte__int_exchange_rates
),

-- Join all together
joined as (
    select
        l.line_item_id,
        l.order_id,
        o.shop_id,
        o.customer_id,
        o.order_date,
        o.currency_code,
        l.sku_id,
        l.quantity,
        l.unit_price_local,
        l.unit_cost_local,
        l.is_returned,
        
        -- Exchange Rate Lookup
        -- If currency is EUR, rate is 1.0. If not, join to rates.
        coalesce(r.rate, 1.0) as exchange_rate

    from line_items l
    left join orders o on l.order_id = o.order_id
    left join rates r 
        on o.order_date = r.date_day 
        and o.currency_code = r.from_currency
        and r.to_currency = 'EUR'
),

calculated as (
    select
        *,
        -- Monetary conversions
        unit_price_local * exchange_rate as unit_price_eur,
        unit_cost_local * exchange_rate as unit_cost_eur,
        
        -- Line Totals
        (unit_price_local * exchange_rate) * quantity as gross_revenue_eur,
        (unit_cost_local * exchange_rate) * quantity as cogs_eur
        
    from joined
)

select * from calculated
),  __dbt__cte__int_marketing_allocated as (
with orders_std as (
    select * from __dbt__cte__int_orders_standardized
),

marketing_daily as (
    select * from "vantage"."main"."stg_marketing"
),

-- 1. Daily Sales Summary (Dominator for allocation)
daily_sales as (
    select
        order_date,
        shop_id,
        sum(gross_revenue_eur) as total_daily_revenue_eur
    from orders_std
    group by 1, 2
),

-- 2. Daily Spend (Numerator)
daily_spend as (
    select
        date_day,
        shop_id,
        -- Assume marketing spend in stg is already standardized or matches shop currency
        -- If shop_id=CH, marketing is likely in CHF. We should convert it to EUR too if generating strictly in EUR.
        -- Usage: For simplicity, let's assume raw_marketing_daily is in EUR or close enough for this MVP 
        -- (Since shop_id=CH has base currency CHF, but marketing might be global). 
        -- Actually, generator output has 'currency' col.
        marketing_spend_local
    from marketing_daily
),

-- 3. Allocation Factor
allocation_factors as (
    select
        ds.order_date,
        ds.shop_id,
        ds.total_daily_revenue_eur,
        msp.marketing_spend_local as daily_marketing_spend,
        -- Avoid divide by zero
        case 
            when ds.total_daily_revenue_eur > 0 
            then msp.marketing_spend_local / ds.total_daily_revenue_eur 
            else 0 
        end as cost_per_eur_revenue
    from daily_sales ds
    inner join daily_spend msp 
        on ds.order_date = msp.date_day 
        and ds.shop_id = msp.shop_id
),

-- 4. Apply to Lines
final_allocation as (
    select
        ord.line_item_id,
        ord.order_id,
        ord.gross_revenue_eur,
        af.cost_per_eur_revenue,
        
        -- Allocated Cost
        ord.gross_revenue_eur * af.cost_per_eur_revenue as marketing_cost_allocated_eur
        
    from orders_std ord
    left join allocation_factors af 
        on ord.order_date = af.order_date 
        and ord.shop_id = af.shop_id
)

select * from final_allocation
),  __dbt__cte__int_logistics_costs as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

-- Aggregate items per order
order_stats as (
    select
        order_id,
        count(*) as item_count
    from line_items
    group by 1
),

joined as (
    select
        o.order_id,
        o.shop_id,
        s.item_count
    from orders o
    left join order_stats s on o.order_id = s.order_id
),

-- Rule Engine for Logistics
calculated as (
    select
        order_id,
        shop_id,
        item_count,
        -- Rule: Base 3.50 EUR (8.50 CH) + 0.50 per item
        case
            when shop_id = 'CH' then 8.50 + (item_count * 0.50)
            else 3.50 + (item_count * 0.50)
        end as logistics_cost_eur
    from joined
)

select * from calculated
), orders_allocated as (
    select * from __dbt__cte__int_marketing_allocated
),

logistics as (
    select * from __dbt__cte__int_logistics_costs
),

final as (
    select
        -- Keys
        o.order_id,
        o.line_item_id,
        
        -- Dimensions
        cast(orders_allocated.order_date as date) as date_key,
        orders_allocated.shop_id as shop_key,
        orders_allocated.customer_id as customer_key,
        orders_allocated.sku_id as product_key,
        
        -- Metrics
        orders_allocated.quantity,
        orders_allocated.gross_revenue_eur,
        
        -- Costs
        -- COGS
        orders_allocated.gross_revenue_eur * (orders_allocated.unit_cost_local / orders_allocated.unit_price_local) as cogs_eur, 
        -- (Doing Ratio calc to be safe on currency, or just use unit_cost_eur column if I had it exposed... 
        -- Wait, int_orders_standardized calculates cogs_eur. 
        -- But int_marketing_allocated only selects a few cols! 
        -- I should update int_marketing_allocated to select * or join back.)
        
        -- Let's assume standard joins back to `int_orders_standardized` for cleanliness, 
        -- OR update `int_marketing_allocated` to pass through everything.
        -- Looking at `int_marketing_allocated.sql`, it selects specific cols. 
        -- I will join back to `int_orders_standardized` here.
        
        orders_std.cogs_eur,
        
        -- Logistics (Allocated by Item Count weighting)
        -- Logic: Total Order Logistics Cost / Total Items in Order
        (l.logistics_cost_eur / l.item_count) as logistics_allocated_eur,
        
        -- Marketing (Already allocated)
        orders_allocated.marketing_cost_allocated_eur,
        
        -- Margin
        orders_allocated.gross_revenue_eur 
            - orders_std.cogs_eur 
            - (l.logistics_cost_eur / l.item_count)
            - orders_allocated.marketing_cost_allocated_eur 
        as contribution_margin_eur,
        
        orders_std.is_returned

    from orders_allocated
    
    -- Join back to Standardized for COGS/Attributes
    left join __dbt__cte__int_orders_standardized orders_std 
        using (line_item_id)
        
    -- Join Logistics
    left join logistics l 
        using (order_id)
)

select * from final
    );
  
  
[0m01:19:58.185917 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m01:19:58.186175 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: ROLLBACK
[0m01:19:58.191815 [debug] [Thread-1 (]: Failed to rollback 'model.vantage_rebuild.fct_transactions'
[0m01:19:58.192028 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: Close
[0m01:19:58.193327 [debug] [Thread-1 (]: Runtime Error in model fct_transactions (models/marts/fct_transactions.sql)
  Binder Error: Ambiguous reference to column name "order_id" (use: "orders_allocated.order_id" or "orders_std.order_id")
[0m01:19:58.193588 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98a459c1-0f6a-4fe1-abff-48a1f81c54f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df15210>]}
[0m01:19:58.193896 [error] [Thread-1 (]: 10 of 11 ERROR creating sql table model main.fct_transactions .................. [[31mERROR[0m in 0.03s]
[0m01:19:58.194173 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.fct_transactions
[0m01:19:58.194669 [debug] [Thread-1 (]: Began running node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:19:58.194898 [info ] [Thread-1 (]: 11 of 11 SKIP test assert_marketing_fully_allocated ............................ [[33mSKIP[0m]
[0m01:19:58.195090 [debug] [Thread-1 (]: Finished running node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:19:58.195706 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:58.195868 [debug] [MainThread]: On master: BEGIN
[0m01:19:58.195996 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:19:58.196340 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:58.196477 [debug] [MainThread]: On master: COMMIT
[0m01:19:58.196601 [debug] [MainThread]: Using duckdb connection "master"
[0m01:19:58.196721 [debug] [MainThread]: On master: COMMIT
[0m01:19:58.196928 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:19:58.197058 [debug] [MainThread]: On master: Close
[0m01:19:58.197224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:19:58.197348 [debug] [MainThread]: Connection 'model.vantage_rebuild.fct_transactions' was properly closed.
[0m01:19:58.197541 [info ] [MainThread]: 
[0m01:19:58.197700 [info ] [MainThread]: Finished running 4 table models, 5 view models, 1 seed, 1 test in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m01:19:58.198438 [debug] [MainThread]: Command end result
[0m01:19:58.216956 [info ] [MainThread]: 
[0m01:19:58.217221 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:19:58.217381 [info ] [MainThread]: 
[0m01:19:58.217566 [error] [MainThread]:   Runtime Error in model fct_transactions (models/marts/fct_transactions.sql)
  Binder Error: Ambiguous reference to column name "order_id" (use: "orders_allocated.order_id" or "orders_std.order_id")
[0m01:19:58.218095 [info ] [MainThread]: 
[0m01:19:58.218282 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=1 TOTAL=11
[0m01:19:58.219802 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 1.2509792, "process_user_time": 1.563723, "process_kernel_time": 0.307383, "process_mem_max_rss": "161284096", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:19:58.220097 [debug] [MainThread]: Command `dbt build` failed at 01:19:58.220055 after 1.25 seconds
[0m01:19:58.220308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055be350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c527750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c527710>]}
[0m01:19:58.220489 [debug] [MainThread]: Flushing usage events
[0m01:20:20.796386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096a0210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109713190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109713790>]}


============================== 01:20:20.799611 | f0a7a57b-ee9e-4933-a468-15c4029eb58f ==============================
[0m01:20:20.799611 [info ] [MainThread]: Running with dbt=1.8.0
[0m01:20:20.799941 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:20:20.992998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b59450>]}
[0m01:20:21.016904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c97110>]}
[0m01:20:21.018527 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m01:20:21.080912 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m01:20:21.158848 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:20:21.159248 [debug] [MainThread]: Partial parsing: updated file: vantage_rebuild://models/marts/fct_transactions.sql
[0m01:20:21.278831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e94b10>]}
[0m01:20:21.343766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a40fed0>]}
[0m01:20:21.344083 [info ] [MainThread]: Found 13 models, 1 seed, 1 test, 5 sources, 438 macros
[0m01:20:21.345480 [info ] [MainThread]: 
[0m01:20:21.345768 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m01:20:21.348145 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_vantage'
[0m01:20:21.406780 [debug] [ThreadPool]: Using duckdb connection "list_vantage"
[0m01:20:21.407068 [debug] [ThreadPool]: On list_vantage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"vantage"'
    
  
  
[0m01:20:21.407226 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:20:21.470942 [debug] [ThreadPool]: SQL status: OK in 0.064 seconds
[0m01:20:21.472065 [debug] [ThreadPool]: On list_vantage: Close
[0m01:20:21.472430 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_vantage, now create_vantage_main)
[0m01:20:21.472650 [debug] [ThreadPool]: Creating schema "database: "vantage"
schema: "main"
"
[0m01:20:21.476038 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:21.476217 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='vantage'
        and type='sqlite'
    
  
[0m01:20:21.476359 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:20:21.477175 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:20:21.477801 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:21.477942 [debug] [ThreadPool]: On create_vantage_main: BEGIN
[0m01:20:21.478168 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:21.478303 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:21.478434 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
    
        create schema if not exists "vantage"."main"
    
[0m01:20:21.478686 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:21.479125 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:20:21.479264 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:21.479391 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:20:21.479607 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:21.479747 [debug] [ThreadPool]: On create_vantage_main: Close
[0m01:20:21.480533 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_vantage_main, now list_vantage_main)
[0m01:20:21.483249 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:20:21.483409 [debug] [ThreadPool]: On list_vantage_main: BEGIN
[0m01:20:21.483940 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:20:21.484368 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:21.484522 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:20:21.484673 [debug] [ThreadPool]: On list_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage_main"} */
select
      'vantage' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'vantage'
  
[0m01:20:21.494586 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m01:20:21.495476 [debug] [ThreadPool]: On list_vantage_main: ROLLBACK
[0m01:20:21.496064 [debug] [ThreadPool]: Failed to rollback 'list_vantage_main'
[0m01:20:21.496204 [debug] [ThreadPool]: On list_vantage_main: Close
[0m01:20:21.497309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0d7b50>]}
[0m01:20:21.497560 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:21.497703 [debug] [MainThread]: On master: BEGIN
[0m01:20:21.497830 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:20:21.498151 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:21.498284 [debug] [MainThread]: On master: COMMIT
[0m01:20:21.498409 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:21.498527 [debug] [MainThread]: On master: COMMIT
[0m01:20:21.498719 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:21.498851 [debug] [MainThread]: On master: Close
[0m01:20:21.499040 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:20:21.499191 [info ] [MainThread]: 
[0m01:20:21.500897 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.dim_calendar
[0m01:20:21.501233 [info ] [Thread-1 (]: 1 of 11 START sql table model main.dim_calendar ................................ [RUN]
[0m01:20:21.501531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_vantage_main, now model.vantage_rebuild.dim_calendar)
[0m01:20:21.501715 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.dim_calendar
[0m01:20:21.504974 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.dim_calendar"
[0m01:20:21.505548 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.dim_calendar
[0m01:20:21.521447 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.dim_calendar"
[0m01:20:21.521924 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.522088 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: BEGIN
[0m01:20:21.522235 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.522590 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.522745 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.522924 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

  
    
    

    create  table
      "vantage"."main"."dim_calendar__dbt_tmp"
  
    as (
      with recursive date_series as (
    select cast('2024-01-01' as date) as date_day
    union all
    select date_day + interval 1 day
    from date_series
    where date_day < '2024-12-31'
),

final as (
    select
        date_day as date_key,
        extract(year from date_day) as year,
        extract(month from date_day) as month_num,
        monthname(date_day) as month_name,
        week(date_day) as iso_week,
        dayofweek(date_day) as day_of_week_num, -- 0=Sun in some DBs, DuckDB: 0=Sun? No, DuckDB ISODOW is 1=Mon. dayofweek 0=Sun.
        case when dayofweek(date_day) in (0, 6) then true else false end as is_weekend
    from date_series
)

select * from final
    );
  
  
[0m01:20:21.542416 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m01:20:21.545251 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.545452 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_calendar'
  
[0m01:20:21.545945 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.546526 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.546687 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_calendar'
  
[0m01:20:21.547270 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.550273 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.550458 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */
alter table "vantage"."main"."dim_calendar" rename to "dim_calendar__dbt_backup"
[0m01:20:21.550930 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.552907 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.553120 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */
alter table "vantage"."main"."dim_calendar__dbt_tmp" rename to "dim_calendar"
[0m01:20:21.553552 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.561848 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: COMMIT
[0m01:20:21.562114 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.562281 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: COMMIT
[0m01:20:21.563502 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:21.566284 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:21.566481 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

      drop table if exists "vantage"."main"."dim_calendar__dbt_backup" cascade
    
[0m01:20:21.567127 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.568558 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: Close
[0m01:20:21.569292 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096edc50>]}
[0m01:20:21.569613 [info ] [Thread-1 (]: 1 of 11 OK created sql table model main.dim_calendar ........................... [[32mOK[0m in 0.07s]
[0m01:20:21.569921 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.dim_calendar
[0m01:20:21.570138 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_budget
[0m01:20:21.570390 [info ] [Thread-1 (]: 2 of 11 START sql view model main.stg_budget ................................... [RUN]
[0m01:20:21.570598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.dim_calendar, now model.vantage_rebuild.stg_budget)
[0m01:20:21.570763 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_budget
[0m01:20:21.572243 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_budget"
[0m01:20:21.572583 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_budget
[0m01:20:21.581317 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_budget"
[0m01:20:21.581806 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:21.581980 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: BEGIN
[0m01:20:21.582134 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.582501 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.582655 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:21.582816 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

  
  create view "vantage"."main"."stg_budget__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_budget"
),

renamed as (
    select
        cast(month as date) as budget_month,
        shop_id,
        currency as currency_code,
        budget_revenue,
        -- Generate MD5 key for unique identification if needed in future, though (month, shop) is unique
        concat(shop_id, '-', cast(month as varchar)) as budget_id
    from source
)

select * from renamed
  );

[0m01:20:21.583352 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.585507 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:21.585719 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget" rename to "stg_budget__dbt_backup"
[0m01:20:21.586154 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.587679 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:21.587867 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget__dbt_tmp" rename to "stg_budget"
[0m01:20:21.588202 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.588925 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:20:21.589091 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:21.589235 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:20:21.589699 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.590969 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:21.591147 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

      drop view if exists "vantage"."main"."stg_budget__dbt_backup" cascade
    
[0m01:20:21.591554 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.592205 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: Close
[0m01:20:21.592480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7755d0>]}
[0m01:20:21.592778 [info ] [Thread-1 (]: 2 of 11 OK created sql view model main.stg_budget .............................. [[32mOK[0m in 0.02s]
[0m01:20:21.593033 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_budget
[0m01:20:21.593221 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_line_items
[0m01:20:21.593500 [info ] [Thread-1 (]: 3 of 11 START sql view model main.stg_line_items ............................... [RUN]
[0m01:20:21.593702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_budget, now model.vantage_rebuild.stg_line_items)
[0m01:20:21.593861 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_line_items
[0m01:20:21.595342 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_line_items"
[0m01:20:21.595698 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_line_items
[0m01:20:21.597461 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_line_items"
[0m01:20:21.597822 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:21.597972 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: BEGIN
[0m01:20:21.598111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.598460 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.598608 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:21.598779 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        qty as quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:20:21.599493 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.601586 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:21.602019 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items" rename to "stg_line_items__dbt_backup"
[0m01:20:21.602456 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.603899 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:21.604054 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items__dbt_tmp" rename to "stg_line_items"
[0m01:20:21.604423 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.605309 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:20:21.605530 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:21.605689 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:20:21.606134 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.608517 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:21.608744 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

      drop view if exists "vantage"."main"."stg_line_items__dbt_backup" cascade
    
[0m01:20:21.609279 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.610000 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: Close
[0m01:20:21.610280 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa0c510>]}
[0m01:20:21.610583 [info ] [Thread-1 (]: 3 of 11 OK created sql view model main.stg_line_items .......................... [[32mOK[0m in 0.02s]
[0m01:20:21.610886 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_line_items
[0m01:20:21.611096 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_marketing
[0m01:20:21.611549 [info ] [Thread-1 (]: 4 of 11 START sql view model main.stg_marketing ................................ [RUN]
[0m01:20:21.611774 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_line_items, now model.vantage_rebuild.stg_marketing)
[0m01:20:21.611940 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_marketing
[0m01:20:21.613459 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_marketing"
[0m01:20:21.613868 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_marketing
[0m01:20:21.615879 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_marketing"
[0m01:20:21.616299 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:21.616467 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: BEGIN
[0m01:20:21.616626 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.617186 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:21.617343 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:21.617504 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

  
  create view "vantage"."main"."stg_marketing__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_marketing_daily"
),

renamed as (
    select
        cast(date as date) as date_day,
        shop_id,
        spend_amount as marketing_spend_local,
        currency as currency_code
    from source
)

select * from renamed
  );

[0m01:20:21.618572 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.620561 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:21.620855 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing" rename to "stg_marketing__dbt_backup"
[0m01:20:21.621321 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.623561 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:21.623874 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing__dbt_tmp" rename to "stg_marketing"
[0m01:20:21.624315 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.625086 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:20:21.625262 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:21.625414 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:20:21.625856 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.627152 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:21.627362 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

      drop view if exists "vantage"."main"."stg_marketing__dbt_backup" cascade
    
[0m01:20:21.627798 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.628504 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: Close
[0m01:20:21.628827 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097437d0>]}
[0m01:20:21.629143 [info ] [Thread-1 (]: 4 of 11 OK created sql view model main.stg_marketing ........................... [[32mOK[0m in 0.02s]
[0m01:20:21.629421 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_marketing
[0m01:20:21.629621 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_orders
[0m01:20:21.629899 [info ] [Thread-1 (]: 5 of 11 START sql view model main.stg_orders ................................... [RUN]
[0m01:20:21.630126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_marketing, now model.vantage_rebuild.stg_orders)
[0m01:20:21.630289 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_orders
[0m01:20:21.631716 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_orders"
[0m01:20:21.632075 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_orders
[0m01:20:21.634218 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_orders"
[0m01:20:21.634651 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:21.634851 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: BEGIN
[0m01:20:21.635206 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.635592 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.635749 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:21.635915 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

  
  create view "vantage"."main"."stg_orders__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_orders"
),

renamed as (
    select
        order_id,
        customer_id,
        shop_id,
        -- Correct datatypes
        cast(order_date as date) as order_date,
        currency_code
    from source
)

select * from renamed
  );

[0m01:20:21.636411 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.638141 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:21.638353 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders" rename to "stg_orders__dbt_backup"
[0m01:20:21.638768 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.640484 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:21.640717 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m01:20:21.641171 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.641981 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:20:21.642168 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:21.642335 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:20:21.642762 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.644297 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:21.644562 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

      drop view if exists "vantage"."main"."stg_orders__dbt_backup" cascade
    
[0m01:20:21.645156 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.646419 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: Close
[0m01:20:21.646794 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a760ad0>]}
[0m01:20:21.647237 [info ] [Thread-1 (]: 5 of 11 OK created sql view model main.stg_orders .............................. [[32mOK[0m in 0.02s]
[0m01:20:21.647643 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_orders
[0m01:20:21.647875 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_products
[0m01:20:21.648161 [info ] [Thread-1 (]: 6 of 11 START sql view model main.stg_products ................................. [RUN]
[0m01:20:21.648531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_orders, now model.vantage_rebuild.stg_products)
[0m01:20:21.648714 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_products
[0m01:20:21.652824 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_products"
[0m01:20:21.654417 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_products
[0m01:20:21.658622 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_products"
[0m01:20:21.659333 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:21.659540 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: BEGIN
[0m01:20:21.659696 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.660090 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.660263 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:21.660431 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

  
  create view "vantage"."main"."stg_products__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_products"
),

renamed as (
    select
        sku_id,
        category,
        product_name,
        avg_price_eur as list_price_eur,
        unit_cost_eur,
        popularity_score
    from source
)

select * from renamed
  );

[0m01:20:21.661131 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:21.662857 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:21.663055 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products" rename to "stg_products__dbt_backup"
[0m01:20:21.663432 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.664825 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:21.664991 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products__dbt_tmp" rename to "stg_products"
[0m01:20:21.665292 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.666004 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:20:21.666184 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:21.666345 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:20:21.666728 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.668456 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:21.668687 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

      drop view if exists "vantage"."main"."stg_products__dbt_backup" cascade
    
[0m01:20:21.669200 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.669881 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: Close
[0m01:20:21.670139 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa43e90>]}
[0m01:20:21.670410 [info ] [Thread-1 (]: 6 of 11 OK created sql view model main.stg_products ............................ [[32mOK[0m in 0.02s]
[0m01:20:21.670665 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_products
[0m01:20:21.670861 [debug] [Thread-1 (]: Began running node seed.vantage_rebuild.exchange_rates
[0m01:20:21.671270 [info ] [Thread-1 (]: 7 of 11 START seed file main.exchange_rates .................................... [RUN]
[0m01:20:21.671535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_products, now seed.vantage_rebuild.exchange_rates)
[0m01:20:21.671711 [debug] [Thread-1 (]: Began compiling node seed.vantage_rebuild.exchange_rates
[0m01:20:21.671866 [debug] [Thread-1 (]: Began executing node seed.vantage_rebuild.exchange_rates
[0m01:20:21.688658 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:21.688949 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: BEGIN
[0m01:20:21.689099 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.689453 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.689607 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:21.689759 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "seed.vantage_rebuild.exchange_rates"} */
truncate table "vantage"."main"."exchange_rates"
[0m01:20:21.690431 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.695946 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:21.696194 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: 
          COPY "vantage"."main"."exchange_rates" FROM '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/seeds/exchange_rates.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m01:20:21.715877 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m01:20:21.719154 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.vantage_rebuild.exchange_rates"
[0m01:20:21.720369 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:20:21.720589 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:21.720753 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:20:21.721453 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:21.722042 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: Close
[0m01:20:21.722344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a5050>]}
[0m01:20:21.722592 [info ] [Thread-1 (]: 7 of 11 OK loaded seed file main.exchange_rates ................................ [[32mINSERT 366[0m in 0.05s]
[0m01:20:21.722861 [debug] [Thread-1 (]: Finished running node seed.vantage_rebuild.exchange_rates
[0m01:20:21.723061 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.fct_budget_daily
[0m01:20:21.723364 [info ] [Thread-1 (]: 8 of 11 START sql table model main.fct_budget_daily ............................ [RUN]
[0m01:20:21.723565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.vantage_rebuild.exchange_rates, now model.vantage_rebuild.fct_budget_daily)
[0m01:20:21.723724 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.fct_budget_daily
[0m01:20:21.725146 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.725511 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.fct_budget_daily
[0m01:20:21.727231 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.727521 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.727675 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: BEGIN
[0m01:20:21.727821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.728161 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.728311 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.728599 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

  
    
    

    create  table
      "vantage"."main"."fct_budget_daily__dbt_tmp"
  
    as (
      with budget as (
    select * from "vantage"."main"."stg_budget"
),

-- Generate Daily Budget (Linear Split)
-- We need a date spine, but for MVP we can fan out by joining to a calendar or just dividing by 30
-- Ideally use dbt_utils.date_spine.
-- Hack for MVP: Just keep it Monthly? No, spec says Daily.
-- We will assume 30 days per month for simplicity here to avoid massive join complexity without a calendar source.
-- BETTER: Use recursive CTE to generate days.

dates as (
    -- Recursively generate days for 2024
    with recursive date_series as (
        select cast('2024-01-01' as date) as date_day
        union all
        select date_day + interval 1 day
        from date_series
        where date_day < '2024-12-31'
    )
    select * from date_series
),

final as (
    select
        d.date_day,
        b.shop_id,
        b.currency_code,
        -- Simple allocation: Monthly Budget / Days in Month
        b.budget_revenue / extract(day from last_day(d.date_day)) as daily_budget_revenue
    from budget b
    inner join dates d 
        on extract(month from d.date_day) = extract(month from b.budget_month)
        and extract(year from d.date_day) = extract(year from b.budget_month)
)

select * from final
    );
  
  
[0m01:20:21.749296 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m01:20:21.749952 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.750130 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_budget_daily'
  
[0m01:20:21.750614 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.751460 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.751690 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_budget_daily'
  
[0m01:20:21.752224 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.753941 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.754147 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */
alter table "vantage"."main"."fct_budget_daily" rename to "fct_budget_daily__dbt_backup"
[0m01:20:21.754527 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.757070 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.757340 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */
alter table "vantage"."main"."fct_budget_daily__dbt_tmp" rename to "fct_budget_daily"
[0m01:20:21.757803 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.758669 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: COMMIT
[0m01:20:21.758844 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.759000 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: COMMIT
[0m01:20:21.759514 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.760808 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:21.761007 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

      drop table if exists "vantage"."main"."fct_budget_daily__dbt_backup" cascade
    
[0m01:20:21.761602 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.762320 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: Close
[0m01:20:21.762623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a75e090>]}
[0m01:20:21.762935 [info ] [Thread-1 (]: 8 of 11 OK created sql table model main.fct_budget_daily ....................... [[32mOK[0m in 0.04s]
[0m01:20:21.763217 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.fct_budget_daily
[0m01:20:21.763409 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_logistics_costs
[0m01:20:21.763634 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.fct_budget_daily, now model.vantage_rebuild.int_logistics_costs)
[0m01:20:21.763795 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_logistics_costs
[0m01:20:21.765399 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_logistics_costs"
[0m01:20:21.766150 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_logistics_costs
[0m01:20:21.766362 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.dim_products
[0m01:20:21.766631 [info ] [Thread-1 (]: 9 of 11 START sql table model main.dim_products ................................ [RUN]
[0m01:20:21.767338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_logistics_costs, now model.vantage_rebuild.dim_products)
[0m01:20:21.767538 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.dim_products
[0m01:20:21.769441 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.dim_products"
[0m01:20:21.770089 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.dim_products
[0m01:20:21.772572 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.dim_products"
[0m01:20:21.773015 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.773181 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: BEGIN
[0m01:20:21.773333 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.773731 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.773924 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.774101 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

  
    
    

    create  table
      "vantage"."main"."dim_products__dbt_tmp"
  
    as (
      with products as (
    select * from "vantage"."main"."stg_products"
)

select
    sku_id,
    product_name,
    category,
    -- Simple tiers based on price/category
    case 
        when category = 'Ausrüstung' then 'Hardware'
        when category = 'Schuhe' then 'Footwear'
        else 'Apparel'
    end as business_unit,
    list_price_eur
from products
    );
  
  
[0m01:20:21.775515 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:21.776168 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.776359 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_products'
  
[0m01:20:21.776855 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.777432 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.777606 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_products'
  
[0m01:20:21.778109 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.779931 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.780201 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */
alter table "vantage"."main"."dim_products" rename to "dim_products__dbt_backup"
[0m01:20:21.780635 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.782405 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.782639 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */
alter table "vantage"."main"."dim_products__dbt_tmp" rename to "dim_products"
[0m01:20:21.783081 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.784174 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: COMMIT
[0m01:20:21.784390 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.784548 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: COMMIT
[0m01:20:21.785114 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.786469 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:21.786701 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

      drop table if exists "vantage"."main"."dim_products__dbt_backup" cascade
    
[0m01:20:21.787241 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.787926 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: Close
[0m01:20:21.788193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108733950>]}
[0m01:20:21.788492 [info ] [Thread-1 (]: 9 of 11 OK created sql table model main.dim_products ........................... [[32mOK[0m in 0.02s]
[0m01:20:21.788755 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.dim_products
[0m01:20:21.788950 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_exchange_rates
[0m01:20:21.789190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.dim_products, now model.vantage_rebuild.int_exchange_rates)
[0m01:20:21.789385 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_exchange_rates
[0m01:20:21.790893 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_exchange_rates"
[0m01:20:21.791395 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_exchange_rates
[0m01:20:21.791745 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_orders_standardized
[0m01:20:21.791965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_exchange_rates, now model.vantage_rebuild.int_orders_standardized)
[0m01:20:21.792131 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_orders_standardized
[0m01:20:21.802187 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_orders_standardized"
[0m01:20:21.803330 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_orders_standardized
[0m01:20:21.806074 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_marketing_allocated
[0m01:20:21.806472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_orders_standardized, now model.vantage_rebuild.int_marketing_allocated)
[0m01:20:21.806904 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_marketing_allocated
[0m01:20:21.821653 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_marketing_allocated"
[0m01:20:21.822382 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_marketing_allocated
[0m01:20:21.822825 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.fct_transactions
[0m01:20:21.823125 [info ] [Thread-1 (]: 10 of 11 START sql table model main.fct_transactions ........................... [RUN]
[0m01:20:21.823382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_marketing_allocated, now model.vantage_rebuild.fct_transactions)
[0m01:20:21.823574 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.fct_transactions
[0m01:20:21.837007 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.fct_transactions"
[0m01:20:21.839962 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.fct_transactions
[0m01:20:21.842683 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.fct_transactions"
[0m01:20:21.843148 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:21.843319 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: BEGIN
[0m01:20:21.843477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:21.843890 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:21.844046 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:21.844428 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */

  
    
    

    create  table
      "vantage"."main"."fct_transactions__dbt_tmp"
  
    as (
      with  __dbt__cte__int_exchange_rates as (
with rate_source as (
    select * from "vantage"."main"."exchange_rates"
),

final as (
    select
        date_day,
        from_currency,
        to_currency,
        rate
    from rate_source
    -- We assume only 'to_currency' = EUR matters for now
    where to_currency = 'EUR'
)

select * from final
),  __dbt__cte__int_orders_standardized as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

rates as (
    select * from __dbt__cte__int_exchange_rates
),

-- Join all together
joined as (
    select
        l.line_item_id,
        l.order_id,
        o.shop_id,
        o.customer_id,
        o.order_date,
        o.currency_code,
        l.sku_id,
        l.quantity,
        l.unit_price_local,
        l.unit_cost_local,
        l.is_returned,
        
        -- Exchange Rate Lookup
        -- If currency is EUR, rate is 1.0. If not, join to rates.
        coalesce(r.rate, 1.0) as exchange_rate

    from line_items l
    left join orders o on l.order_id = o.order_id
    left join rates r 
        on o.order_date = r.date_day 
        and o.currency_code = r.from_currency
        and r.to_currency = 'EUR'
),

calculated as (
    select
        *,
        -- Monetary conversions
        unit_price_local * exchange_rate as unit_price_eur,
        unit_cost_local * exchange_rate as unit_cost_eur,
        
        -- Line Totals
        (unit_price_local * exchange_rate) * quantity as gross_revenue_eur,
        (unit_cost_local * exchange_rate) * quantity as cogs_eur
        
    from joined
)

select * from calculated
),  __dbt__cte__int_marketing_allocated as (
with orders_std as (
    select * from __dbt__cte__int_orders_standardized
),

marketing_daily as (
    select * from "vantage"."main"."stg_marketing"
),

-- 1. Daily Sales Summary (Dominator for allocation)
daily_sales as (
    select
        order_date,
        shop_id,
        sum(gross_revenue_eur) as total_daily_revenue_eur
    from orders_std
    group by 1, 2
),

-- 2. Daily Spend (Numerator)
daily_spend as (
    select
        date_day,
        shop_id,
        -- Assume marketing spend in stg is already standardized or matches shop currency
        -- If shop_id=CH, marketing is likely in CHF. We should convert it to EUR too if generating strictly in EUR.
        -- Usage: For simplicity, let's assume raw_marketing_daily is in EUR or close enough for this MVP 
        -- (Since shop_id=CH has base currency CHF, but marketing might be global). 
        -- Actually, generator output has 'currency' col.
        marketing_spend_local
    from marketing_daily
),

-- 3. Allocation Factor
allocation_factors as (
    select
        ds.order_date,
        ds.shop_id,
        ds.total_daily_revenue_eur,
        msp.marketing_spend_local as daily_marketing_spend,
        -- Avoid divide by zero
        case 
            when ds.total_daily_revenue_eur > 0 
            then msp.marketing_spend_local / ds.total_daily_revenue_eur 
            else 0 
        end as cost_per_eur_revenue
    from daily_sales ds
    inner join daily_spend msp 
        on ds.order_date = msp.date_day 
        and ds.shop_id = msp.shop_id
),

-- 4. Apply to Lines
final_allocation as (
    select
        ord.line_item_id,
        ord.order_id,
        ord.gross_revenue_eur,
        af.cost_per_eur_revenue,
        
        -- Allocated Cost
        ord.gross_revenue_eur * af.cost_per_eur_revenue as marketing_cost_allocated_eur
        
    from orders_std ord
    left join allocation_factors af 
        on ord.order_date = af.order_date 
        and ord.shop_id = af.shop_id
)

select * from final_allocation
),  __dbt__cte__int_logistics_costs as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

-- Aggregate items per order
order_stats as (
    select
        order_id,
        count(*) as item_count
    from line_items
    group by 1
),

joined as (
    select
        o.order_id,
        o.shop_id,
        s.item_count
    from orders o
    left join order_stats s on o.order_id = s.order_id
),

-- Rule Engine for Logistics
calculated as (
    select
        order_id,
        shop_id,
        item_count,
        -- Rule: Base 3.50 EUR (8.50 CH) + 0.50 per item
        case
            when shop_id = 'CH' then 8.50 + (item_count * 0.50)
            else 3.50 + (item_count * 0.50)
        end as logistics_cost_eur
    from joined
)

select * from calculated
), orders_allocated as (
    select * from __dbt__cte__int_marketing_allocated
),

logistics as (
    select * from __dbt__cte__int_logistics_costs
),

final as (
    select
        -- Keys
        oa.order_id,
        oa.line_item_id,
        
        -- Dimensions
        cast(oa.order_date as date) as date_key,
        oa.shop_id as shop_key,
        oa.customer_id as customer_key,
        oa.sku_id as product_key,
        
        -- Metrics
        oa.quantity,
        oa.gross_revenue_eur,
        
        -- Costs
        -- COGS
        oa.gross_revenue_eur * (oa.unit_cost_local / oa.unit_price_local) as cogs_eur, 
        -- (Doing Ratio calc to be safe on currency, or just use unit_cost_eur column if I had it exposed... 
        -- Wait, int_orders_standardized calculates cogs_eur. 
        -- But int_marketing_allocated only selects a few cols! 
        -- I should update int_marketing_allocated to select * or join back.)
        
        -- Let's assume standard joins back to `int_orders_standardized` for cleanliness, 
        -- OR update `int_marketing_allocated` to pass through everything.
        -- Looking at `int_marketing_allocated.sql`, it selects specific cols. 
        -- I will join back to `int_orders_standardized` here.
        
        orders_std.cogs_eur,
        
        -- Logistics (Allocated by Item Count weighting)
        -- Logic: Total Order Logistics Cost / Total Items in Order
        (l.logistics_cost_eur / l.item_count) as logistics_allocated_eur,
        
        -- Marketing (Already allocated)
        oa.marketing_cost_allocated_eur,
        
        -- Margin
        oa.gross_revenue_eur 
            - orders_std.cogs_eur 
            - (l.logistics_cost_eur / l.item_count)
            - oa.marketing_cost_allocated_eur 
        as contribution_margin_eur,
        
        orders_std.is_returned

    from orders_allocated oa
    
    -- Join back to Standardized for COGS/Attributes
    left join __dbt__cte__int_orders_standardized orders_std 
        using (line_item_id)
        
    -- Join Logistics
    left join logistics l 
        on oa.order_id = l.order_id
)

select * from final
    );
  
  
[0m01:20:21.856444 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */

  
    
    

    create  table
      "vantage"."main"."fct_transactions__dbt_tmp"
  
    as (
      with  __dbt__cte__int_exchange_rates as (
with rate_source as (
    select * from "vantage"."main"."exchange_rates"
),

final as (
    select
        date_day,
        from_currency,
        to_currency,
        rate
    from rate_source
    -- We assume only 'to_currency' = EUR matters for now
    where to_currency = 'EUR'
)

select * from final
),  __dbt__cte__int_orders_standardized as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

rates as (
    select * from __dbt__cte__int_exchange_rates
),

-- Join all together
joined as (
    select
        l.line_item_id,
        l.order_id,
        o.shop_id,
        o.customer_id,
        o.order_date,
        o.currency_code,
        l.sku_id,
        l.quantity,
        l.unit_price_local,
        l.unit_cost_local,
        l.is_returned,
        
        -- Exchange Rate Lookup
        -- If currency is EUR, rate is 1.0. If not, join to rates.
        coalesce(r.rate, 1.0) as exchange_rate

    from line_items l
    left join orders o on l.order_id = o.order_id
    left join rates r 
        on o.order_date = r.date_day 
        and o.currency_code = r.from_currency
        and r.to_currency = 'EUR'
),

calculated as (
    select
        *,
        -- Monetary conversions
        unit_price_local * exchange_rate as unit_price_eur,
        unit_cost_local * exchange_rate as unit_cost_eur,
        
        -- Line Totals
        (unit_price_local * exchange_rate) * quantity as gross_revenue_eur,
        (unit_cost_local * exchange_rate) * quantity as cogs_eur
        
    from joined
)

select * from calculated
),  __dbt__cte__int_marketing_allocated as (
with orders_std as (
    select * from __dbt__cte__int_orders_standardized
),

marketing_daily as (
    select * from "vantage"."main"."stg_marketing"
),

-- 1. Daily Sales Summary (Dominator for allocation)
daily_sales as (
    select
        order_date,
        shop_id,
        sum(gross_revenue_eur) as total_daily_revenue_eur
    from orders_std
    group by 1, 2
),

-- 2. Daily Spend (Numerator)
daily_spend as (
    select
        date_day,
        shop_id,
        -- Assume marketing spend in stg is already standardized or matches shop currency
        -- If shop_id=CH, marketing is likely in CHF. We should convert it to EUR too if generating strictly in EUR.
        -- Usage: For simplicity, let's assume raw_marketing_daily is in EUR or close enough for this MVP 
        -- (Since shop_id=CH has base currency CHF, but marketing might be global). 
        -- Actually, generator output has 'currency' col.
        marketing_spend_local
    from marketing_daily
),

-- 3. Allocation Factor
allocation_factors as (
    select
        ds.order_date,
        ds.shop_id,
        ds.total_daily_revenue_eur,
        msp.marketing_spend_local as daily_marketing_spend,
        -- Avoid divide by zero
        case 
            when ds.total_daily_revenue_eur > 0 
            then msp.marketing_spend_local / ds.total_daily_revenue_eur 
            else 0 
        end as cost_per_eur_revenue
    from daily_sales ds
    inner join daily_spend msp 
        on ds.order_date = msp.date_day 
        and ds.shop_id = msp.shop_id
),

-- 4. Apply to Lines
final_allocation as (
    select
        ord.line_item_id,
        ord.order_id,
        ord.gross_revenue_eur,
        af.cost_per_eur_revenue,
        
        -- Allocated Cost
        ord.gross_revenue_eur * af.cost_per_eur_revenue as marketing_cost_allocated_eur
        
    from orders_std ord
    left join allocation_factors af 
        on ord.order_date = af.order_date 
        and ord.shop_id = af.shop_id
)

select * from final_allocation
),  __dbt__cte__int_logistics_costs as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

-- Aggregate items per order
order_stats as (
    select
        order_id,
        count(*) as item_count
    from line_items
    group by 1
),

joined as (
    select
        o.order_id,
        o.shop_id,
        s.item_count
    from orders o
    left join order_stats s on o.order_id = s.order_id
),

-- Rule Engine for Logistics
calculated as (
    select
        order_id,
        shop_id,
        item_count,
        -- Rule: Base 3.50 EUR (8.50 CH) + 0.50 per item
        case
            when shop_id = 'CH' then 8.50 + (item_count * 0.50)
            else 3.50 + (item_count * 0.50)
        end as logistics_cost_eur
    from joined
)

select * from calculated
), orders_allocated as (
    select * from __dbt__cte__int_marketing_allocated
),

logistics as (
    select * from __dbt__cte__int_logistics_costs
),

final as (
    select
        -- Keys
        oa.order_id,
        oa.line_item_id,
        
        -- Dimensions
        cast(oa.order_date as date) as date_key,
        oa.shop_id as shop_key,
        oa.customer_id as customer_key,
        oa.sku_id as product_key,
        
        -- Metrics
        oa.quantity,
        oa.gross_revenue_eur,
        
        -- Costs
        -- COGS
        oa.gross_revenue_eur * (oa.unit_cost_local / oa.unit_price_local) as cogs_eur, 
        -- (Doing Ratio calc to be safe on currency, or just use unit_cost_eur column if I had it exposed... 
        -- Wait, int_orders_standardized calculates cogs_eur. 
        -- But int_marketing_allocated only selects a few cols! 
        -- I should update int_marketing_allocated to select * or join back.)
        
        -- Let's assume standard joins back to `int_orders_standardized` for cleanliness, 
        -- OR update `int_marketing_allocated` to pass through everything.
        -- Looking at `int_marketing_allocated.sql`, it selects specific cols. 
        -- I will join back to `int_orders_standardized` here.
        
        orders_std.cogs_eur,
        
        -- Logistics (Allocated by Item Count weighting)
        -- Logic: Total Order Logistics Cost / Total Items in Order
        (l.logistics_cost_eur / l.item_count) as logistics_allocated_eur,
        
        -- Marketing (Already allocated)
        oa.marketing_cost_allocated_eur,
        
        -- Margin
        oa.gross_revenue_eur 
            - orders_std.cogs_eur 
            - (l.logistics_cost_eur / l.item_count)
            - oa.marketing_cost_allocated_eur 
        as contribution_margin_eur,
        
        orders_std.is_returned

    from orders_allocated oa
    
    -- Join back to Standardized for COGS/Attributes
    left join __dbt__cte__int_orders_standardized orders_std 
        using (line_item_id)
        
    -- Join Logistics
    left join logistics l 
        on oa.order_id = l.order_id
)

select * from final
    );
  
  
[0m01:20:21.857000 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m01:20:21.857252 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: ROLLBACK
[0m01:20:21.861519 [debug] [Thread-1 (]: Failed to rollback 'model.vantage_rebuild.fct_transactions'
[0m01:20:21.861906 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: Close
[0m01:20:21.863408 [debug] [Thread-1 (]: Runtime Error in model fct_transactions (models/marts/fct_transactions.sql)
  Binder Error: Values list "oa" does not have a column named "order_date"
  
  LINE 210:         cast(oa.order_date as date) as date_key,
                         ^
[0m01:20:21.863717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f0a7a57b-ee9e-4933-a468-15c4029eb58f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa282d0>]}
[0m01:20:21.864083 [error] [Thread-1 (]: 10 of 11 ERROR creating sql table model main.fct_transactions .................. [[31mERROR[0m in 0.04s]
[0m01:20:21.864389 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.fct_transactions
[0m01:20:21.864887 [debug] [Thread-1 (]: Began running node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:20:21.865116 [info ] [Thread-1 (]: 11 of 11 SKIP test assert_marketing_fully_allocated ............................ [[33mSKIP[0m]
[0m01:20:21.865408 [debug] [Thread-1 (]: Finished running node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:20:21.866014 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:21.866179 [debug] [MainThread]: On master: BEGIN
[0m01:20:21.866309 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:20:21.866661 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:21.866799 [debug] [MainThread]: On master: COMMIT
[0m01:20:21.866920 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:21.867039 [debug] [MainThread]: On master: COMMIT
[0m01:20:21.867233 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:21.867361 [debug] [MainThread]: On master: Close
[0m01:20:21.867528 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:20:21.867780 [debug] [MainThread]: Connection 'model.vantage_rebuild.fct_transactions' was properly closed.
[0m01:20:21.868047 [info ] [MainThread]: 
[0m01:20:21.868220 [info ] [MainThread]: Finished running 4 table models, 5 view models, 1 seed, 1 test in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m01:20:21.868976 [debug] [MainThread]: Command end result
[0m01:20:21.885920 [info ] [MainThread]: 
[0m01:20:21.886583 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:20:21.886867 [info ] [MainThread]: 
[0m01:20:21.887084 [error] [MainThread]:   Runtime Error in model fct_transactions (models/marts/fct_transactions.sql)
  Binder Error: Values list "oa" does not have a column named "order_date"
  
  LINE 210:         cast(oa.order_date as date) as date_key,
                         ^
[0m01:20:21.887249 [info ] [MainThread]: 
[0m01:20:21.887448 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=1 TOTAL=11
[0m01:20:21.889042 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 1.1252562, "process_user_time": 1.537194, "process_kernel_time": 0.285948, "process_mem_max_rss": "158662656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:20:21.889347 [debug] [MainThread]: Command `dbt build` failed at 01:20:21.889304 after 1.13 seconds
[0m01:20:21.889553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031be390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109713a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109735550>]}
[0m01:20:21.889733 [debug] [MainThread]: Flushing usage events
[0m01:20:34.791567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ade010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b4eb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b2ecd0>]}


============================== 01:20:34.794501 | 98c121f9-b234-4714-8cf1-4f7d7eda6dcb ==============================
[0m01:20:34.794501 [info ] [MainThread]: Running with dbt=1.8.0
[0m01:20:34.794877 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:20:35.080155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b90ad0>]}
[0m01:20:35.106454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b97450>]}
[0m01:20:35.108268 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m01:20:35.175053 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m01:20:35.257871 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:20:35.258372 [debug] [MainThread]: Partial parsing: updated file: vantage_rebuild://models/intermediate/int_marketing_allocated.sql
[0m01:20:35.375913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134a4ed0>]}
[0m01:20:35.444136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114017e50>]}
[0m01:20:35.444453 [info ] [MainThread]: Found 13 models, 1 seed, 1 test, 5 sources, 438 macros
[0m01:20:35.445889 [info ] [MainThread]: 
[0m01:20:35.446212 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m01:20:35.448713 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_vantage'
[0m01:20:35.510963 [debug] [ThreadPool]: Using duckdb connection "list_vantage"
[0m01:20:35.511222 [debug] [ThreadPool]: On list_vantage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"vantage"'
    
  
  
[0m01:20:35.511363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:20:35.563902 [debug] [ThreadPool]: SQL status: OK in 0.052 seconds
[0m01:20:35.565573 [debug] [ThreadPool]: On list_vantage: Close
[0m01:20:35.565968 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_vantage, now create_vantage_main)
[0m01:20:35.566196 [debug] [ThreadPool]: Creating schema "database: "vantage"
schema: "main"
"
[0m01:20:35.573505 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:35.573931 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='vantage'
        and type='sqlite'
    
  
[0m01:20:35.574341 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:20:35.575357 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:20:35.576268 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:35.576476 [debug] [ThreadPool]: On create_vantage_main: BEGIN
[0m01:20:35.576799 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:35.576939 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:35.577073 [debug] [ThreadPool]: On create_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "create_vantage_main"} */

    
    
        create schema if not exists "vantage"."main"
    
[0m01:20:35.577387 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:35.577962 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:20:35.578117 [debug] [ThreadPool]: Using duckdb connection "create_vantage_main"
[0m01:20:35.578256 [debug] [ThreadPool]: On create_vantage_main: COMMIT
[0m01:20:35.578526 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m01:20:35.578665 [debug] [ThreadPool]: On create_vantage_main: Close
[0m01:20:35.579608 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_vantage_main, now list_vantage_main)
[0m01:20:35.582789 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:20:35.583022 [debug] [ThreadPool]: On list_vantage_main: BEGIN
[0m01:20:35.583159 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:20:35.583725 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m01:20:35.583871 [debug] [ThreadPool]: Using duckdb connection "list_vantage_main"
[0m01:20:35.584013 [debug] [ThreadPool]: On list_vantage_main: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "connection_name": "list_vantage_main"} */
select
      'vantage' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'vantage'
  
[0m01:20:35.596712 [debug] [ThreadPool]: SQL status: OK in 0.012 seconds
[0m01:20:35.597753 [debug] [ThreadPool]: On list_vantage_main: ROLLBACK
[0m01:20:35.598422 [debug] [ThreadPool]: Failed to rollback 'list_vantage_main'
[0m01:20:35.598595 [debug] [ThreadPool]: On list_vantage_main: Close
[0m01:20:35.599730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134a47d0>]}
[0m01:20:35.599989 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:35.600131 [debug] [MainThread]: On master: BEGIN
[0m01:20:35.600257 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:20:35.600621 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:35.600962 [debug] [MainThread]: On master: COMMIT
[0m01:20:35.601114 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:35.601243 [debug] [MainThread]: On master: COMMIT
[0m01:20:35.601529 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:35.601678 [debug] [MainThread]: On master: Close
[0m01:20:35.601951 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:20:35.602143 [info ] [MainThread]: 
[0m01:20:35.603777 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.dim_calendar
[0m01:20:35.604347 [info ] [Thread-1 (]: 1 of 11 START sql table model main.dim_calendar ................................ [RUN]
[0m01:20:35.604748 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_vantage_main, now model.vantage_rebuild.dim_calendar)
[0m01:20:35.604981 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.dim_calendar
[0m01:20:35.608916 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.dim_calendar"
[0m01:20:35.609488 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.dim_calendar
[0m01:20:35.626255 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.dim_calendar"
[0m01:20:35.626758 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.626922 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: BEGIN
[0m01:20:35.627075 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.627447 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.627592 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.627756 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

  
    
    

    create  table
      "vantage"."main"."dim_calendar__dbt_tmp"
  
    as (
      with recursive date_series as (
    select cast('2024-01-01' as date) as date_day
    union all
    select date_day + interval 1 day
    from date_series
    where date_day < '2024-12-31'
),

final as (
    select
        date_day as date_key,
        extract(year from date_day) as year,
        extract(month from date_day) as month_num,
        monthname(date_day) as month_name,
        week(date_day) as iso_week,
        dayofweek(date_day) as day_of_week_num, -- 0=Sun in some DBs, DuckDB: 0=Sun? No, DuckDB ISODOW is 1=Mon. dayofweek 0=Sun.
        case when dayofweek(date_day) in (0, 6) then true else false end as is_weekend
    from date_series
)

select * from final
    );
  
  
[0m01:20:35.647753 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m01:20:35.650566 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.650781 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_calendar'
  
[0m01:20:35.651652 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.652358 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.652552 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_calendar'
  
[0m01:20:35.653677 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.657053 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.657292 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */
alter table "vantage"."main"."dim_calendar" rename to "dim_calendar__dbt_backup"
[0m01:20:35.658031 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.659472 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.659650 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */
alter table "vantage"."main"."dim_calendar__dbt_tmp" rename to "dim_calendar"
[0m01:20:35.659959 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.668931 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: COMMIT
[0m01:20:35.669349 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.669528 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: COMMIT
[0m01:20:35.670946 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.673947 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_calendar"
[0m01:20:35.676320 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_calendar"} */

      drop table if exists "vantage"."main"."dim_calendar__dbt_backup" cascade
    
[0m01:20:35.682641 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m01:20:35.683889 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_calendar: Close
[0m01:20:35.685914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f10350>]}
[0m01:20:35.686287 [info ] [Thread-1 (]: 1 of 11 OK created sql table model main.dim_calendar ........................... [[32mOK[0m in 0.08s]
[0m01:20:35.686578 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.dim_calendar
[0m01:20:35.686783 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_budget
[0m01:20:35.687029 [info ] [Thread-1 (]: 2 of 11 START sql view model main.stg_budget ................................... [RUN]
[0m01:20:35.687234 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.dim_calendar, now model.vantage_rebuild.stg_budget)
[0m01:20:35.687392 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_budget
[0m01:20:35.689043 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_budget"
[0m01:20:35.689921 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_budget
[0m01:20:35.698662 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_budget"
[0m01:20:35.699143 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:35.699314 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: BEGIN
[0m01:20:35.699468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.699856 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.700012 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:35.700179 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

  
  create view "vantage"."main"."stg_budget__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_budget"
),

renamed as (
    select
        cast(month as date) as budget_month,
        shop_id,
        currency as currency_code,
        budget_revenue,
        -- Generate MD5 key for unique identification if needed in future, though (month, shop) is unique
        concat(shop_id, '-', cast(month as varchar)) as budget_id
    from source
)

select * from renamed
  );

[0m01:20:35.700668 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.702614 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:35.702856 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget" rename to "stg_budget__dbt_backup"
[0m01:20:35.703325 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.704930 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:35.705146 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */
alter view "vantage"."main"."stg_budget__dbt_tmp" rename to "stg_budget"
[0m01:20:35.705526 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.706299 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:20:35.706477 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:35.706628 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: COMMIT
[0m01:20:35.707302 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.708767 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_budget"
[0m01:20:35.708979 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_budget"} */

      drop view if exists "vantage"."main"."stg_budget__dbt_backup" cascade
    
[0m01:20:35.709427 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.710115 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_budget: Close
[0m01:20:35.710397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112bdaa50>]}
[0m01:20:35.710728 [info ] [Thread-1 (]: 2 of 11 OK created sql view model main.stg_budget .............................. [[32mOK[0m in 0.02s]
[0m01:20:35.710993 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_budget
[0m01:20:35.711189 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_line_items
[0m01:20:35.711509 [info ] [Thread-1 (]: 3 of 11 START sql view model main.stg_line_items ............................... [RUN]
[0m01:20:35.711797 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_budget, now model.vantage_rebuild.stg_line_items)
[0m01:20:35.711982 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_line_items
[0m01:20:35.713647 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_line_items"
[0m01:20:35.714083 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_line_items
[0m01:20:35.716107 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_line_items"
[0m01:20:35.716540 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:35.716828 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: BEGIN
[0m01:20:35.717005 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.717762 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.717958 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:35.718134 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

  
  create view "vantage"."main"."stg_line_items__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_line_items"
),

renamed as (
    select
        line_id as line_item_id,
        order_id,
        sku_id,
        qty as quantity,
        unit_price_paid as unit_price_local,
        unit_cost as unit_cost_local,
        is_returned
    from source
)

select * from renamed
  );

[0m01:20:35.718677 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.720538 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:35.720770 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items" rename to "stg_line_items__dbt_backup"
[0m01:20:35.721204 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.722613 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:35.722808 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */
alter view "vantage"."main"."stg_line_items__dbt_tmp" rename to "stg_line_items"
[0m01:20:35.723151 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.723924 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:20:35.724094 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:35.724243 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: COMMIT
[0m01:20:35.724670 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.727123 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_line_items"
[0m01:20:35.727475 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_line_items"} */

      drop view if exists "vantage"."main"."stg_line_items__dbt_backup" cascade
    
[0m01:20:35.728138 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.728860 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_line_items: Close
[0m01:20:35.729287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114617e10>]}
[0m01:20:35.729608 [info ] [Thread-1 (]: 3 of 11 OK created sql view model main.stg_line_items .......................... [[32mOK[0m in 0.02s]
[0m01:20:35.730213 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_line_items
[0m01:20:35.730435 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_marketing
[0m01:20:35.730802 [info ] [Thread-1 (]: 4 of 11 START sql view model main.stg_marketing ................................ [RUN]
[0m01:20:35.731053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_line_items, now model.vantage_rebuild.stg_marketing)
[0m01:20:35.731217 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_marketing
[0m01:20:35.732647 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_marketing"
[0m01:20:35.733182 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_marketing
[0m01:20:35.737873 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_marketing"
[0m01:20:35.738691 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:35.738910 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: BEGIN
[0m01:20:35.739074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.739485 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.739644 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:35.739811 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

  
  create view "vantage"."main"."stg_marketing__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_marketing_daily"
),

renamed as (
    select
        cast(date as date) as date_day,
        shop_id,
        spend_amount as marketing_spend_local,
        currency as currency_code
    from source
)

select * from renamed
  );

[0m01:20:35.740387 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.742117 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:35.742489 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing" rename to "stg_marketing__dbt_backup"
[0m01:20:35.743273 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.746707 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:35.747058 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */
alter view "vantage"."main"."stg_marketing__dbt_tmp" rename to "stg_marketing"
[0m01:20:35.747590 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.748410 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:20:35.748594 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:35.748747 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: COMMIT
[0m01:20:35.749250 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.751030 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_marketing"
[0m01:20:35.751996 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_marketing"} */

      drop view if exists "vantage"."main"."stg_marketing__dbt_backup" cascade
    
[0m01:20:35.753158 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.754250 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_marketing: Close
[0m01:20:35.754548 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11352fb90>]}
[0m01:20:35.754852 [info ] [Thread-1 (]: 4 of 11 OK created sql view model main.stg_marketing ........................... [[32mOK[0m in 0.02s]
[0m01:20:35.755125 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_marketing
[0m01:20:35.755328 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_orders
[0m01:20:35.755648 [info ] [Thread-1 (]: 5 of 11 START sql view model main.stg_orders ................................... [RUN]
[0m01:20:35.755905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_marketing, now model.vantage_rebuild.stg_orders)
[0m01:20:35.756084 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_orders
[0m01:20:35.757710 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_orders"
[0m01:20:35.758139 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_orders
[0m01:20:35.760292 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_orders"
[0m01:20:35.760754 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:35.760916 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: BEGIN
[0m01:20:35.761060 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.761490 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.761691 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:35.761870 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

  
  create view "vantage"."main"."stg_orders__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_orders"
),

renamed as (
    select
        order_id,
        customer_id,
        shop_id,
        -- Correct datatypes
        cast(order_date as date) as order_date,
        currency_code
    from source
)

select * from renamed
  );

[0m01:20:35.762371 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.764164 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:35.764383 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders" rename to "stg_orders__dbt_backup"
[0m01:20:35.764777 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.766347 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:35.766531 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */
alter view "vantage"."main"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m01:20:35.766899 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.768023 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:20:35.768394 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:35.768563 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: COMMIT
[0m01:20:35.769204 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.772563 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_orders"
[0m01:20:35.772887 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_orders"} */

      drop view if exists "vantage"."main"."stg_orders__dbt_backup" cascade
    
[0m01:20:35.773524 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.774241 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_orders: Close
[0m01:20:35.774513 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fc2750>]}
[0m01:20:35.774817 [info ] [Thread-1 (]: 5 of 11 OK created sql view model main.stg_orders .............................. [[32mOK[0m in 0.02s]
[0m01:20:35.775413 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_orders
[0m01:20:35.775668 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.stg_products
[0m01:20:35.776113 [info ] [Thread-1 (]: 6 of 11 START sql view model main.stg_products ................................. [RUN]
[0m01:20:35.776460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_orders, now model.vantage_rebuild.stg_products)
[0m01:20:35.776642 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.stg_products
[0m01:20:35.778447 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.stg_products"
[0m01:20:35.778892 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.stg_products
[0m01:20:35.783571 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.stg_products"
[0m01:20:35.784085 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:35.784289 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: BEGIN
[0m01:20:35.784510 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.785149 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.785322 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:35.785487 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

  
  create view "vantage"."main"."stg_products__dbt_tmp" as (
    with source as (
    select * from "vantage"."main"."raw_products"
),

renamed as (
    select
        sku_id,
        category,
        product_name,
        avg_price_eur as list_price_eur,
        unit_cost_eur,
        popularity_score
    from source
)

select * from renamed
  );

[0m01:20:35.786008 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.787707 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:35.787922 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products" rename to "stg_products__dbt_backup"
[0m01:20:35.788325 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.789881 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:35.790104 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */
alter view "vantage"."main"."stg_products__dbt_tmp" rename to "stg_products"
[0m01:20:35.790552 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.791389 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:20:35.791574 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:35.791725 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: COMMIT
[0m01:20:35.792274 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.794550 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.stg_products"
[0m01:20:35.795041 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.stg_products"} */

      drop view if exists "vantage"."main"."stg_products__dbt_backup" cascade
    
[0m01:20:35.796326 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.798641 [debug] [Thread-1 (]: On model.vantage_rebuild.stg_products: Close
[0m01:20:35.799082 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114643610>]}
[0m01:20:35.799408 [info ] [Thread-1 (]: 6 of 11 OK created sql view model main.stg_products ............................ [[32mOK[0m in 0.02s]
[0m01:20:35.799685 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.stg_products
[0m01:20:35.799893 [debug] [Thread-1 (]: Began running node seed.vantage_rebuild.exchange_rates
[0m01:20:35.800215 [info ] [Thread-1 (]: 7 of 11 START seed file main.exchange_rates .................................... [RUN]
[0m01:20:35.800481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.stg_products, now seed.vantage_rebuild.exchange_rates)
[0m01:20:35.800663 [debug] [Thread-1 (]: Began compiling node seed.vantage_rebuild.exchange_rates
[0m01:20:35.800828 [debug] [Thread-1 (]: Began executing node seed.vantage_rebuild.exchange_rates
[0m01:20:35.821584 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:35.821878 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: BEGIN
[0m01:20:35.822041 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.822427 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.822583 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:35.822737 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "seed.vantage_rebuild.exchange_rates"} */
truncate table "vantage"."main"."exchange_rates"
[0m01:20:35.823342 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.828793 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:35.829034 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: 
          COPY "vantage"."main"."exchange_rates" FROM '/Users/admin/Desktop/BI Pipeline/vantage-rebuild/dbt_project/seeds/exchange_rates.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m01:20:35.849161 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m01:20:35.852392 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.vantage_rebuild.exchange_rates"
[0m01:20:35.853452 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:20:35.853633 [debug] [Thread-1 (]: Using duckdb connection "seed.vantage_rebuild.exchange_rates"
[0m01:20:35.853787 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: COMMIT
[0m01:20:35.854536 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.855059 [debug] [Thread-1 (]: On seed.vantage_rebuild.exchange_rates: Close
[0m01:20:35.855323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ee55d0>]}
[0m01:20:35.855572 [info ] [Thread-1 (]: 7 of 11 OK loaded seed file main.exchange_rates ................................ [[32mINSERT 366[0m in 0.05s]
[0m01:20:35.855838 [debug] [Thread-1 (]: Finished running node seed.vantage_rebuild.exchange_rates
[0m01:20:35.856034 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.fct_budget_daily
[0m01:20:35.856328 [info ] [Thread-1 (]: 8 of 11 START sql table model main.fct_budget_daily ............................ [RUN]
[0m01:20:35.856522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.vantage_rebuild.exchange_rates, now model.vantage_rebuild.fct_budget_daily)
[0m01:20:35.856679 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.fct_budget_daily
[0m01:20:35.858186 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.858543 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.fct_budget_daily
[0m01:20:35.860300 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.860601 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.860757 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: BEGIN
[0m01:20:35.860904 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.861266 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.861425 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.861793 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

  
    
    

    create  table
      "vantage"."main"."fct_budget_daily__dbt_tmp"
  
    as (
      with budget as (
    select * from "vantage"."main"."stg_budget"
),

-- Generate Daily Budget (Linear Split)
-- We need a date spine, but for MVP we can fan out by joining to a calendar or just dividing by 30
-- Ideally use dbt_utils.date_spine.
-- Hack for MVP: Just keep it Monthly? No, spec says Daily.
-- We will assume 30 days per month for simplicity here to avoid massive join complexity without a calendar source.
-- BETTER: Use recursive CTE to generate days.

dates as (
    -- Recursively generate days for 2024
    with recursive date_series as (
        select cast('2024-01-01' as date) as date_day
        union all
        select date_day + interval 1 day
        from date_series
        where date_day < '2024-12-31'
    )
    select * from date_series
),

final as (
    select
        d.date_day,
        b.shop_id,
        b.currency_code,
        -- Simple allocation: Monthly Budget / Days in Month
        b.budget_revenue / extract(day from last_day(d.date_day)) as daily_budget_revenue
    from budget b
    inner join dates d 
        on extract(month from d.date_day) = extract(month from b.budget_month)
        and extract(year from d.date_day) = extract(year from b.budget_month)
)

select * from final
    );
  
  
[0m01:20:35.878828 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m01:20:35.879521 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.879707 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_budget_daily'
  
[0m01:20:35.880206 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.880764 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.880937 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'fct_budget_daily'
  
[0m01:20:35.881361 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.882969 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.883155 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */
alter table "vantage"."main"."fct_budget_daily" rename to "fct_budget_daily__dbt_backup"
[0m01:20:35.883467 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.885942 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.886214 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */
alter table "vantage"."main"."fct_budget_daily__dbt_tmp" rename to "fct_budget_daily"
[0m01:20:35.886638 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.887479 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: COMMIT
[0m01:20:35.887642 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.887786 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: COMMIT
[0m01:20:35.888356 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.889632 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_budget_daily"
[0m01:20:35.889813 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_budget_daily"} */

      drop table if exists "vantage"."main"."fct_budget_daily__dbt_backup" cascade
    
[0m01:20:35.890379 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.890963 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_budget_daily: Close
[0m01:20:35.891213 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111eba790>]}
[0m01:20:35.891495 [info ] [Thread-1 (]: 8 of 11 OK created sql table model main.fct_budget_daily ....................... [[32mOK[0m in 0.03s]
[0m01:20:35.891752 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.fct_budget_daily
[0m01:20:35.891933 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_logistics_costs
[0m01:20:35.892139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.fct_budget_daily, now model.vantage_rebuild.int_logistics_costs)
[0m01:20:35.892295 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_logistics_costs
[0m01:20:35.893735 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_logistics_costs"
[0m01:20:35.894276 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_logistics_costs
[0m01:20:35.894455 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.dim_products
[0m01:20:35.894674 [info ] [Thread-1 (]: 9 of 11 START sql table model main.dim_products ................................ [RUN]
[0m01:20:35.894857 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_logistics_costs, now model.vantage_rebuild.dim_products)
[0m01:20:35.895011 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.dim_products
[0m01:20:35.896176 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.dim_products"
[0m01:20:35.896491 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.dim_products
[0m01:20:35.898409 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.dim_products"
[0m01:20:35.898815 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.898981 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: BEGIN
[0m01:20:35.899130 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.899516 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.899714 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.899903 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

  
    
    

    create  table
      "vantage"."main"."dim_products__dbt_tmp"
  
    as (
      with products as (
    select * from "vantage"."main"."stg_products"
)

select
    sku_id,
    product_name,
    category,
    -- Simple tiers based on price/category
    case 
        when category = 'Ausrüstung' then 'Hardware'
        when category = 'Schuhe' then 'Footwear'
        else 'Apparel'
    end as business_unit,
    list_price_eur
from products
    );
  
  
[0m01:20:35.901453 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m01:20:35.902030 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.902207 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_products'
  
[0m01:20:35.902706 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.903278 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.903446 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_products'
  
[0m01:20:35.903859 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.905465 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.905658 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */
alter table "vantage"."main"."dim_products" rename to "dim_products__dbt_backup"
[0m01:20:35.906000 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.907344 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.907521 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */
alter table "vantage"."main"."dim_products__dbt_tmp" rename to "dim_products"
[0m01:20:35.907796 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.908532 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: COMMIT
[0m01:20:35.908683 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.908823 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: COMMIT
[0m01:20:35.909304 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.910450 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.dim_products"
[0m01:20:35.910621 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.dim_products"} */

      drop table if exists "vantage"."main"."dim_products__dbt_backup" cascade
    
[0m01:20:35.910991 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.911545 [debug] [Thread-1 (]: On model.vantage_rebuild.dim_products: Close
[0m01:20:35.911795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114379550>]}
[0m01:20:35.912085 [info ] [Thread-1 (]: 9 of 11 OK created sql table model main.dim_products ........................... [[32mOK[0m in 0.02s]
[0m01:20:35.912340 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.dim_products
[0m01:20:35.912522 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_exchange_rates
[0m01:20:35.912742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.dim_products, now model.vantage_rebuild.int_exchange_rates)
[0m01:20:35.912920 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_exchange_rates
[0m01:20:35.914355 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_exchange_rates"
[0m01:20:35.914855 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_exchange_rates
[0m01:20:35.915191 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_orders_standardized
[0m01:20:35.915412 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_exchange_rates, now model.vantage_rebuild.int_orders_standardized)
[0m01:20:35.915572 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_orders_standardized
[0m01:20:35.923433 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_orders_standardized"
[0m01:20:35.924398 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_orders_standardized
[0m01:20:35.924773 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.int_marketing_allocated
[0m01:20:35.925052 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_orders_standardized, now model.vantage_rebuild.int_marketing_allocated)
[0m01:20:35.925242 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.int_marketing_allocated
[0m01:20:35.934923 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.int_marketing_allocated"
[0m01:20:35.935615 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.int_marketing_allocated
[0m01:20:35.935971 [debug] [Thread-1 (]: Began running node model.vantage_rebuild.fct_transactions
[0m01:20:35.936284 [info ] [Thread-1 (]: 10 of 11 START sql table model main.fct_transactions ........................... [RUN]
[0m01:20:35.936535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.int_marketing_allocated, now model.vantage_rebuild.fct_transactions)
[0m01:20:35.936712 [debug] [Thread-1 (]: Began compiling node model.vantage_rebuild.fct_transactions
[0m01:20:35.944788 [debug] [Thread-1 (]: Writing injected SQL for node "model.vantage_rebuild.fct_transactions"
[0m01:20:35.945233 [debug] [Thread-1 (]: Began executing node model.vantage_rebuild.fct_transactions
[0m01:20:35.947332 [debug] [Thread-1 (]: Writing runtime sql for node "model.vantage_rebuild.fct_transactions"
[0m01:20:35.947715 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:35.947878 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: BEGIN
[0m01:20:35.948023 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:35.948382 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:35.948533 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:35.948909 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */

  
    
    

    create  table
      "vantage"."main"."fct_transactions__dbt_tmp"
  
    as (
      with  __dbt__cte__int_exchange_rates as (
with rate_source as (
    select * from "vantage"."main"."exchange_rates"
),

final as (
    select
        date_day,
        from_currency,
        to_currency,
        rate
    from rate_source
    -- We assume only 'to_currency' = EUR matters for now
    where to_currency = 'EUR'
)

select * from final
),  __dbt__cte__int_orders_standardized as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

rates as (
    select * from __dbt__cte__int_exchange_rates
),

-- Join all together
joined as (
    select
        l.line_item_id,
        l.order_id,
        o.shop_id,
        o.customer_id,
        o.order_date,
        o.currency_code,
        l.sku_id,
        l.quantity,
        l.unit_price_local,
        l.unit_cost_local,
        l.is_returned,
        
        -- Exchange Rate Lookup
        -- If currency is EUR, rate is 1.0. If not, join to rates.
        coalesce(r.rate, 1.0) as exchange_rate

    from line_items l
    left join orders o on l.order_id = o.order_id
    left join rates r 
        on o.order_date = r.date_day 
        and o.currency_code = r.from_currency
        and r.to_currency = 'EUR'
),

calculated as (
    select
        *,
        -- Monetary conversions
        unit_price_local * exchange_rate as unit_price_eur,
        unit_cost_local * exchange_rate as unit_cost_eur,
        
        -- Line Totals
        (unit_price_local * exchange_rate) * quantity as gross_revenue_eur,
        (unit_cost_local * exchange_rate) * quantity as cogs_eur
        
    from joined
)

select * from calculated
),  __dbt__cte__int_marketing_allocated as (
with orders_std as (
    select * from __dbt__cte__int_orders_standardized
),

marketing_daily as (
    select * from "vantage"."main"."stg_marketing"
),

-- 1. Daily Sales Summary (Dominator for allocation)
daily_sales as (
    select
        order_date,
        shop_id,
        sum(gross_revenue_eur) as total_daily_revenue_eur
    from orders_std
    group by 1, 2
),

-- 2. Daily Spend (Numerator)
daily_spend as (
    select
        date_day,
        shop_id,
        -- Assume marketing spend in stg is already standardized or matches shop currency
        -- If shop_id=CH, marketing is likely in CHF. We should convert it to EUR too if generating strictly in EUR.
        -- Usage: For simplicity, let's assume raw_marketing_daily is in EUR or close enough for this MVP 
        -- (Since shop_id=CH has base currency CHF, but marketing might be global). 
        -- Actually, generator output has 'currency' col.
        marketing_spend_local
    from marketing_daily
),

-- 3. Allocation Factor
allocation_factors as (
    select
        ds.order_date,
        ds.shop_id,
        ds.total_daily_revenue_eur,
        msp.marketing_spend_local as daily_marketing_spend,
        -- Avoid divide by zero
        case 
            when ds.total_daily_revenue_eur > 0 
            then msp.marketing_spend_local / ds.total_daily_revenue_eur 
            else 0 
        end as cost_per_eur_revenue
    from daily_sales ds
    inner join daily_spend msp 
        on ds.order_date = msp.date_day 
        and ds.shop_id = msp.shop_id
),

-- 4. Apply to Lines
final_allocation as (
    select
        ord.line_item_id,
        ord.order_id,
        ord.order_date,
        ord.shop_id,
        ord.customer_id,
        ord.sku_id,
        ord.quantity,
        ord.unit_price_local,
        ord.unit_cost_local,
        ord.gross_revenue_eur,
        af.cost_per_eur_revenue,
        
        -- Allocated Cost
        ord.gross_revenue_eur * af.cost_per_eur_revenue as marketing_cost_allocated_eur
        
    from orders_std ord
    left join allocation_factors af 
        on ord.order_date = af.order_date 
        and ord.shop_id = af.shop_id
)

select * from final_allocation
),  __dbt__cte__int_logistics_costs as (
with orders as (
    select * from "vantage"."main"."stg_orders"
),

line_items as (
    select * from "vantage"."main"."stg_line_items"
),

-- Aggregate items per order
order_stats as (
    select
        order_id,
        count(*) as item_count
    from line_items
    group by 1
),

joined as (
    select
        o.order_id,
        o.shop_id,
        s.item_count
    from orders o
    left join order_stats s on o.order_id = s.order_id
),

-- Rule Engine for Logistics
calculated as (
    select
        order_id,
        shop_id,
        item_count,
        -- Rule: Base 3.50 EUR (8.50 CH) + 0.50 per item
        case
            when shop_id = 'CH' then 8.50 + (item_count * 0.50)
            else 3.50 + (item_count * 0.50)
        end as logistics_cost_eur
    from joined
)

select * from calculated
), orders_allocated as (
    select * from __dbt__cte__int_marketing_allocated
),

logistics as (
    select * from __dbt__cte__int_logistics_costs
),

final as (
    select
        -- Keys
        oa.order_id,
        oa.line_item_id,
        
        -- Dimensions
        cast(oa.order_date as date) as date_key,
        oa.shop_id as shop_key,
        oa.customer_id as customer_key,
        oa.sku_id as product_key,
        
        -- Metrics
        oa.quantity,
        oa.gross_revenue_eur,
        
        -- Costs
        -- COGS
        oa.gross_revenue_eur * (oa.unit_cost_local / oa.unit_price_local) as cogs_eur, 
        -- (Doing Ratio calc to be safe on currency, or just use unit_cost_eur column if I had it exposed... 
        -- Wait, int_orders_standardized calculates cogs_eur. 
        -- But int_marketing_allocated only selects a few cols! 
        -- I should update int_marketing_allocated to select * or join back.)
        
        -- Let's assume standard joins back to `int_orders_standardized` for cleanliness, 
        -- OR update `int_marketing_allocated` to pass through everything.
        -- Looking at `int_marketing_allocated.sql`, it selects specific cols. 
        -- I will join back to `int_orders_standardized` here.
        
        orders_std.cogs_eur,
        
        -- Logistics (Allocated by Item Count weighting)
        -- Logic: Total Order Logistics Cost / Total Items in Order
        (l.logistics_cost_eur / l.item_count) as logistics_allocated_eur,
        
        -- Marketing (Already allocated)
        oa.marketing_cost_allocated_eur,
        
        -- Margin
        oa.gross_revenue_eur 
            - orders_std.cogs_eur 
            - (l.logistics_cost_eur / l.item_count)
            - oa.marketing_cost_allocated_eur 
        as contribution_margin_eur,
        
        orders_std.is_returned

    from orders_allocated oa
    
    -- Join back to Standardized for COGS/Attributes
    left join __dbt__cte__int_orders_standardized orders_std 
        using (line_item_id)
        
    -- Join Logistics
    left join logistics l 
        on oa.order_id = l.order_id
)

select * from final
    );
  
  
[0m01:20:36.000951 [debug] [Thread-1 (]: SQL status: OK in 0.052 seconds
[0m01:20:36.003148 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:36.003344 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */
alter table "vantage"."main"."fct_transactions__dbt_tmp" rename to "fct_transactions"
[0m01:20:36.003809 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:36.004553 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: COMMIT
[0m01:20:36.004736 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:36.004885 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: COMMIT
[0m01:20:36.014008 [debug] [Thread-1 (]: SQL status: OK in 0.009 seconds
[0m01:20:36.015610 [debug] [Thread-1 (]: Using duckdb connection "model.vantage_rebuild.fct_transactions"
[0m01:20:36.015849 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "model.vantage_rebuild.fct_transactions"} */

      drop table if exists "vantage"."main"."fct_transactions__dbt_backup" cascade
    
[0m01:20:36.016257 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:36.017014 [debug] [Thread-1 (]: On model.vantage_rebuild.fct_transactions: Close
[0m01:20:36.017290 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98c121f9-b234-4714-8cf1-4f7d7eda6dcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f00350>]}
[0m01:20:36.017663 [info ] [Thread-1 (]: 10 of 11 OK created sql table model main.fct_transactions ...................... [[32mOK[0m in 0.08s]
[0m01:20:36.018598 [debug] [Thread-1 (]: Finished running node model.vantage_rebuild.fct_transactions
[0m01:20:36.019130 [debug] [Thread-1 (]: Began running node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:20:36.019750 [info ] [Thread-1 (]: 11 of 11 START test assert_marketing_fully_allocated ........................... [RUN]
[0m01:20:36.020181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.vantage_rebuild.fct_transactions, now test.vantage_rebuild.assert_marketing_fully_allocated)
[0m01:20:36.020371 [debug] [Thread-1 (]: Began compiling node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:20:36.022101 [debug] [Thread-1 (]: Writing injected SQL for node "test.vantage_rebuild.assert_marketing_fully_allocated"
[0m01:20:36.022601 [debug] [Thread-1 (]: Began executing node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:20:36.034299 [debug] [Thread-1 (]: Writing runtime sql for node "test.vantage_rebuild.assert_marketing_fully_allocated"
[0m01:20:36.035147 [debug] [Thread-1 (]: Using duckdb connection "test.vantage_rebuild.assert_marketing_fully_allocated"
[0m01:20:36.035354 [debug] [Thread-1 (]: On test.vantage_rebuild.assert_marketing_fully_allocated: BEGIN
[0m01:20:36.035520 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:36.035918 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m01:20:36.036080 [debug] [Thread-1 (]: Using duckdb connection "test.vantage_rebuild.assert_marketing_fully_allocated"
[0m01:20:36.036277 [debug] [Thread-1 (]: On test.vantage_rebuild.assert_marketing_fully_allocated: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "duckdb_local", "target_name": "dev", "node_id": "test.vantage_rebuild.assert_marketing_fully_allocated"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- assert_marketing_fully_allocated.sql
with source as (
    select sum(marketing_spend_local) as total_spend
    from "vantage"."main"."stg_marketing"
    -- Convert to EUR if mixed currencies? For MVP we assume input was normalized or single currency per shop.
    -- Generator output had 'EUR' for DE/AT and 'CHF' for CH.
    -- Wait, if CH spend is CHF, and we allocated based on EUR revenue...
    -- The `int_marketing_allocated` took `marketing_spend_local / total_daily_revenue_eur`.
    -- This implies we treated local spend as EUR! (Which is a bug if spend was CHF).
    -- However, for the TEST, we just want to ensure the Distribution Math worked (i.e. we didn't lose money in rounding).
    -- So we compare Sum(Spend) vs Sum(Allocated).
),

fact as (
    select sum(marketing_cost_allocated_eur) as total_allocated
    from "vantage"."main"."fct_transactions"
)

select * 
from source, fact
where abs(source.total_spend - fact.total_allocated) > 5.0 
-- Allow 5 EUR tolerance for rounding errors across 365 days
      
    ) dbt_internal_test
[0m01:20:36.038172 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m01:20:36.040275 [debug] [Thread-1 (]: On test.vantage_rebuild.assert_marketing_fully_allocated: ROLLBACK
[0m01:20:36.040622 [debug] [Thread-1 (]: Failed to rollback 'test.vantage_rebuild.assert_marketing_fully_allocated'
[0m01:20:36.040790 [debug] [Thread-1 (]: On test.vantage_rebuild.assert_marketing_fully_allocated: Close
[0m01:20:36.041104 [info ] [Thread-1 (]: 11 of 11 PASS assert_marketing_fully_allocated ................................. [[32mPASS[0m in 0.02s]
[0m01:20:36.041367 [debug] [Thread-1 (]: Finished running node test.vantage_rebuild.assert_marketing_fully_allocated
[0m01:20:36.041939 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:36.042123 [debug] [MainThread]: On master: BEGIN
[0m01:20:36.042260 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:20:36.042632 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:36.042772 [debug] [MainThread]: On master: COMMIT
[0m01:20:36.042898 [debug] [MainThread]: Using duckdb connection "master"
[0m01:20:36.043019 [debug] [MainThread]: On master: COMMIT
[0m01:20:36.043229 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m01:20:36.043354 [debug] [MainThread]: On master: Close
[0m01:20:36.043516 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:20:36.043637 [debug] [MainThread]: Connection 'test.vantage_rebuild.assert_marketing_fully_allocated' was properly closed.
[0m01:20:36.043807 [info ] [MainThread]: 
[0m01:20:36.043952 [info ] [MainThread]: Finished running 4 table models, 5 view models, 1 seed, 1 test in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m01:20:36.044724 [debug] [MainThread]: Command end result
[0m01:20:36.063381 [info ] [MainThread]: 
[0m01:20:36.063673 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:20:36.063831 [info ] [MainThread]: 
[0m01:20:36.063986 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m01:20:36.065419 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.3062639, "process_user_time": 1.640025, "process_kernel_time": 0.329481, "process_mem_max_rss": "241434624", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:20:36.065725 [debug] [MainThread]: Command `dbt build` succeeded at 01:20:36.065676 after 1.31 seconds
[0m01:20:36.065933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104632250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125e1b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10452bfd0>]}
[0m01:20:36.066116 [debug] [MainThread]: Flushing usage events
